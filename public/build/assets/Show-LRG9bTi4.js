import{c as P}from"./AppLayout.vue_vue_type_script_setup_true_lang-D9M3x5ue.js";import{d as A,r as C,a as f,o as m,b as o,f as a,n as K,w as n,e as t,t as i,i as d,F as _,g as h,h as q,x as V,l as w}from"./app-D_3ES-MA.js";import{_ as b}from"./Input.vue_vue_type_script_setup_true_lang-CnHYR_KV.js";import{_ as g}from"./Label.vue_vue_type_script_setup_true_lang-DN94hrUr.js";import{_ as v}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DRehq9_I.js";import{_ as S,a as $,b as O,c as N,d as x}from"./SelectValue.vue_vue_type_script_setup_true_lang-DCIDyPaO.js";import{_ as M}from"./CreateContactDialog.vue_vue_type_script_setup_true_lang-DqCzt8WK.js";import"./useForwardExpose-DKOBYQgN.js";import"./VisuallyHidden-CBaPXAve.js";import"./chevron-down-Btkkdgsb.js";import"./check-Bp38obHO.js";import"./useFormControl-CT9Zey5N.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-BbLZj7f_.js";import"./loader-circle-BtasXw6i.js";const B={class:"flex flex-col p-4 overflow-x-auto h-full"},I={class:"text-2xl font-bold mb-4"},J={class:"grid grid-cols-1 lg:grid-cols-[2fr_3fr] gap-6 h-full"},R={class:"space-y-3 bg-white rounded-xl p-4 shadow"},X={class:"flex flex-col"},D={class:"flex flex-col"},L={class:"flex flex-col"},U={class:"flex flex-col"},H={class:"flex flex-col"},G={class:"flex flex-col"},Q={class:"flex flex-col"},W={class:"flex flex-col gap-6"},Y={class:"bg-white rounded-xl p-4 shadow flex-1 overflow-auto max-h-[400px]"},Z={class:"min-w-full border text-sm"},tt={class:"p-2"},st={class:"bg-white rounded-xl p-4 shadow"},et={class:"flex justify-between mb-2 items-center"},ot={class:"min-w-full border text-sm"},at={class:"p-2"},lt={class:"p-2"},nt={class:"p-2"},it={class:"p-2"},rt={class:"p-2"},dt={class:"p-2"},ut={class:"p-2"},mt={class:"p-2 flex gap-2"},ct={class:"bg-white rounded-xl p-4 shadow"},ft={key:0,class:"text-gray-500"},gt={class:"bg-white rounded-xl p-4 shadow"},_t={class:"min-w-full border text-sm"},pt={class:"p-2"},bt={class:"p-2"},xt={class:"p-2"},yt={class:"p-2"},ht={class:"p-2"},vt={class:"p-2"},At=A({__name:"Show",props:{organisation:{type:Object,required:!0},customers:{type:Array,required:!0}},setup(l){const r=l;let y=r.organisation.customer;console.log("Organisation:",r.organisation);const T=C([]),z=C([]),F=[{title:"Organisations",href:"/organisations"},{title:r.organisation.name,href:`/organisations/${r.organisation.id}`}],j=()=>{let u=r.organisation.customer;if(u){const s=y?.id;fetch(`/organisations/${r.organisation.id}/change-customer`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({cus_id:u.id})}).then(e=>{e.ok?(s&&(r.organisation.contacts=r.organisation.contacts.filter(c=>c.cus_id!==s)),y=u):r.organisation.customer=y}).catch(e=>{console.error("Error updating customer:",e),r.organisation.customer=y})}},k=u=>{if(r.organisation.contacts.find(e=>e.id===u).is_primary){console.log("Contact is already primary:",u);return}fetch(`/organisations/${r.organisation.id}/make-primary-contact`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({contact_id:u})}).then(e=>{if(e.ok){r.organisation.contacts.forEach(p=>{p.is_primary=!1});const c=r.organisation.contacts.find(p=>p.id===u);c&&(c.is_primary=!0)}else console.error("Failed to update primary contact")})},E=u=>{fetch(`/organisations/${r.organisation.id}/remove-contact`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({contact_id:u})})};return(u,s)=>(m(),f(_,null,[o(a(K),{title:`Organisation - ${l.organisation.name}`},null,8,["title"]),o(P,{breadcrumbs:F},{default:n(()=>[t("div",B,[t("h1",I,i(l.organisation.name),1),t("div",J,[t("div",R,[t("div",X,[o(a(g),{class:"font-semibold capitalize"},{default:n(()=>s[4]||(s[4]=[d("Navn",-1)])),_:1,__:[4]}),o(a(b),{modelValue:l.organisation.name,readonly:""},null,8,["modelValue"])]),t("div",D,[o(a(g),{class:"font-semibold capitalize"},{default:n(()=>s[5]||(s[5]=[d("CVR",-1)])),_:1,__:[5]}),o(a(b),{modelValue:l.organisation.cvr,readonly:""},null,8,["modelValue"])]),t("div",L,[o(a(g),{class:"font-semibold capitalize"},{default:n(()=>s[6]||(s[6]=[d("Adresse",-1)])),_:1,__:[6]}),o(a(b),{modelValue:`${l.organisation.address}, ${l.organisation.zip}`,readonly:""},null,8,["modelValue"])]),t("div",U,[o(a(g),{class:"font-semibold capitalize"},{default:n(()=>s[7]||(s[7]=[d("Land",-1)])),_:1,__:[7]}),o(a(b),{modelValue:l.organisation.country,readonly:""},null,8,["modelValue"])]),t("div",H,[o(a(g),{class:"font-semibold capitalize"},{default:n(()=>s[8]||(s[8]=[d("Kunde",-1)])),_:1,__:[8]}),o(a(S),{modelValue:l.organisation.customer,"onUpdate:modelValue":[s[0]||(s[0]=e=>l.organisation.customer=e),s[1]||(s[1]=e=>j())],class:"w-full"},{default:n(()=>[o(a($),{class:"col-span-3 w-full"},{default:n(()=>[o(a(O),{placeholder:l.organisation.customer?.name||"Vælg kunde"},null,8,["placeholder"])]),_:1}),o(a(N),null,{default:n(()=>[(m(!0),f(_,null,h(r.customers,e=>(m(),q(a(x),{key:e.id,value:e},{default:n(()=>[d(i(e.name)+" - "+i(e.email),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),t("div",G,[o(a(g),{class:"font-semibold capitalize"},{default:n(()=>s[9]||(s[9]=[d("Valuta",-1)])),_:1,__:[9]}),o(a(b),{modelValue:l.organisation.customer?.currency,readonly:""},null,8,["modelValue"])]),t("div",Q,[o(a(g),{class:"font-semibold capitalize"},{default:n(()=>s[10]||(s[10]=[d("Type",-1)])),_:1,__:[10]}),o(a(S),{modelValue:l.organisation.type,"onUpdate:modelValue":s[2]||(s[2]=e=>l.organisation.type=e),class:"w-full"},{default:n(()=>[o(a($),{class:"col-span-3 w-full"},{default:n(()=>[o(a(O),{placeholder:"Select type"})]),_:1}),o(a(N),null,{default:n(()=>[o(a(x),{value:"organisation"},{default:n(()=>s[11]||(s[11]=[d("Organisation",-1)])),_:1,__:[11]}),o(a(x),{value:"forening/club"},{default:n(()=>s[12]||(s[12]=[d("Forening/Club",-1)])),_:1,__:[12]}),o(a(x),{value:"company"},{default:n(()=>s[13]||(s[13]=[d("Company",-1)])),_:1,__:[13]}),o(a(x),{value:"school"},{default:n(()=>s[14]||(s[14]=[d("School",-1)])),_:1,__:[14]})]),_:1})]),_:1},8,["modelValue"])])]),t("div",W,[t("div",Y,[s[16]||(s[16]=t("h2",{class:"font-semibold mb-2"},"Opgaveliste",-1)),t("table",Z,[s[15]||(s[15]=t("thead",{class:"bg-gray-100 sticky top-0"},[t("tr",null,[t("th",{class:"p-2 text-left"},"Opgave"),t("th",null,"Status"),t("th",null,"Dato"),t("th",null,"Varighed"),t("th",null,"Sælger"),t("th",null,"Salgskode"),t("th",null,"Note")])],-1)),t("tbody",null,[(m(!0),f(_,null,h(T.value,(e,c)=>(m(),f("tr",{key:c,class:"border-t"},[t("td",tt,i(e.task),1),t("td",null,i(e.status),1),t("td",null,i(e.date),1),t("td",null,i(e.duration),1),t("td",null,i(e.seller),1),t("td",null,i(e.salesCode),1),t("td",null,i(e.note),1)]))),128))])])]),t("div",st,[t("div",et,[s[17]||(s[17]=t("h2",{class:"font-semibold"},"Kontakter",-1)),o(a(M),{organisation:l.organisation},null,8,["organisation"])]),t("table",ot,[s[23]||(s[23]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"p-2 text-left"},"Kontaktperson"),t("th",{class:"p-2 text-left"},"Jobfunktion"),t("th",{class:"p-2 text-left"},"Telefon"),t("th",{class:"p-2 text-left"},"Email"),t("th",{class:"p-2 text-left"},"Handling")])],-1)),t("tbody",null,[t("tr",{class:V(["border-t",{"bg-green-100":l.organisation.contacts?.find(e=>e.cus_id===l.organisation.customer?.id&&e.is_primary)}])},[t("td",at,i(l.organisation.customer?.name),1),s[19]||(s[19]=t("td",{class:"p-2"},"Stripe bruger",-1)),s[20]||(s[20]=t("td",{class:"p-2"},"Ikke angivet",-1)),t("td",lt,i(l.organisation.customer?.email||"Ikke angivet"),1),t("td",nt,[o(a(v),{variant:"outline",size:"sm",onClick:s[3]||(s[3]=e=>k(l.organisation.contacts?.find(c=>c.cus_id===l.organisation.customer?.id)?.id))},{default:n(()=>s[18]||(s[18]=[d(" Sæt primær ",-1)])),_:1,__:[18]})])],2),(m(!0),f(_,null,h(l.organisation.contacts,(e,c)=>(m(),f(_,{key:c},[e.cus_id!==l.organisation.customer.id?(m(),f("tr",{key:0,class:V(["border-t",{"bg-green-100":e.is_primary}])},[t("td",it,i(e?.customer?.name??e.contact?.name),1),t("td",rt,i(e.contact?.job??"Ikke angivet"),1),t("td",dt,i(e.contact?.phone??"Ikke angivet"),1),t("td",ut,i(e.customer?.email??e.contact?.email??"Ikke angivet"),1),t("td",mt,[o(a(v),{variant:"outline",size:"sm",onClick:p=>k(e.id)},{default:n(()=>s[21]||(s[21]=[d("Sæt primær",-1)])),_:2,__:[21]},1032,["onClick"]),o(a(v),{variant:"destructive",size:"sm",onClick:p=>E(e.id)},{default:n(()=>s[22]||(s[22]=[d("Fjern",-1)])),_:2,__:[22]},1032,["onClick"])])],2)):w("",!0)],64))),128))])])]),t("div",ct,[s[24]||(s[24]=t("h2",{class:"font-semibold mb-2"},"Aftaler",-1)),z.value.length===0?(m(),f("div",ft,"Ingen aftaler")):w("",!0)])])]),t("div",gt,[s[26]||(s[26]=t("h2",{class:"font-semibold mb-2"},"Packages",-1)),t("table",_t,[s[25]||(s[25]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"p-2 text-left"},"Name"),t("th",{class:"p-2 text-left"},"Price"),t("th",{class:"p-2 text-left"},"Monthly Price"),t("th",{class:"p-2 text-left"},"Max Members"),t("th",{class:"p-2 text-left"},"Max Teams"),t("th",{class:"p-2 text-left"},"Max Stratbooks")])],-1)),t("tbody",null,[(m(!0),f(_,null,h(l.organisation.packages,e=>(m(),f("tr",{key:e.id,class:"border-t"},[t("td",pt,i(e.name),1),t("td",bt,"€"+i(e.price),1),t("td",xt,"€"+i(e.monthly_price),1),t("td",yt,i(e.max_members),1),t("td",ht,i(e.max_teams),1),t("td",vt,i(e.max_stratbooks),1)]))),128))])])])])]),_:1})],64))}});export{At as default};
