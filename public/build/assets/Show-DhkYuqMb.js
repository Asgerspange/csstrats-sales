import{c as A}from"./AppLayout.vue_vue_type_script_setup_true_lang-BnfF_lSQ.js";import{d as E,k as h,a as c,o as m,b as o,f as l,l as K,w as n,e as t,t as i,h as r,F as _,r as v,g as q,s as V,v as C}from"./app-C5YBmgv4.js";import{_ as y}from"./Input.vue_vue_type_script_setup_true_lang-B-b4KiXl.js";import{_ as g}from"./Label.vue_vue_type_script_setup_true_lang-BXNgG3U0.js";import{_ as x}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B1QAlOJN.js";import{_ as S,a as $,b as w,c as O,d as b}from"./SelectValue.vue_vue_type_script_setup_true_lang-C8QBHOcH.js";import"./useForwardExpose-_lKPIabX.js";import"./VisuallyHidden-3usdfaBV.js";import"./chevron-down-B7S--cpA.js";import"./check-ZHf986tB.js";const B={class:"flex flex-col p-4 overflow-x-auto h-full"},J={class:"text-2xl font-bold mb-4"},P={class:"grid grid-cols-1 lg:grid-cols-[2fr_3fr] gap-6 h-full"},R={class:"space-y-3 bg-white rounded-xl p-4 shadow"},I={class:"flex flex-col"},X={class:"flex flex-col"},D={class:"flex flex-col"},L={class:"flex flex-col"},U={class:"flex flex-col"},H={class:"flex flex-col"},G={class:"flex flex-col"},M={class:"flex flex-col gap-6"},Q={class:"bg-white rounded-xl p-4 shadow flex-1 overflow-auto max-h-[400px]"},W={class:"min-w-full border text-sm"},Y={class:"p-2"},Z={class:"bg-white rounded-xl p-4 shadow"},tt={class:"min-w-full border text-sm"},et={class:"p-2"},st={class:"p-2"},ot={class:"p-2"},lt={class:"p-2"},at={class:"p-2"},nt={class:"p-2"},it={class:"p-2"},rt={class:"p-2 flex gap-2"},dt={class:"bg-white rounded-xl p-4 shadow"},ut={key:0,class:"text-gray-500"},kt=E({__name:"Show",props:{organisation:{type:Object,required:!0},customers:{type:Array,required:!0}},setup(a){const d=a;console.log("Organisation:",d.organisation);const z=h([]),N=h([]),T=[{title:"Organisations",href:"/organisations"},{title:d.organisation.name,href:`/organisations/${d.organisation.id}`}],F=()=>{let u=d.organisation.customer;u&&fetch(`/organisations/${d.organisation.id}/change-customer`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({cus_id:u.id})})},k=u=>{if(d.organisation.contacts.find(s=>s.id===u).is_primary){console.log("Contact is already primary:",u);return}fetch(`/organisations/${d.organisation.id}/make-primary-contact`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({contact_id:u})}).then(s=>{if(s.ok){d.organisation.contacts.forEach(p=>{p.is_primary=!1});const f=d.organisation.contacts.find(p=>p.id===u);f&&(f.is_primary=!0)}else console.error("Failed to update primary contact")})},j=u=>{fetch(`/organisations/${d.organisation.id}/remove-contact`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({contact_id:u})})};return(u,e)=>(m(),c(_,null,[o(l(K),{title:`Organisation - ${a.organisation.name}`},null,8,["title"]),o(A,{breadcrumbs:T},{default:n(()=>[t("div",B,[t("h1",J,i(a.organisation.name),1),t("div",P,[t("div",R,[t("div",I,[o(l(g),{class:"font-semibold capitalize"},{default:n(()=>e[4]||(e[4]=[r("Navn",-1)])),_:1,__:[4]}),o(l(y),{modelValue:a.organisation.name,readonly:""},null,8,["modelValue"])]),t("div",X,[o(l(g),{class:"font-semibold capitalize"},{default:n(()=>e[5]||(e[5]=[r("CVR",-1)])),_:1,__:[5]}),o(l(y),{modelValue:a.organisation.cvr,readonly:""},null,8,["modelValue"])]),t("div",D,[o(l(g),{class:"font-semibold capitalize"},{default:n(()=>e[6]||(e[6]=[r("Adresse",-1)])),_:1,__:[6]}),o(l(y),{modelValue:`${a.organisation.address}, ${a.organisation.zip}`,readonly:""},null,8,["modelValue"])]),t("div",L,[o(l(g),{class:"font-semibold capitalize"},{default:n(()=>e[7]||(e[7]=[r("Land",-1)])),_:1,__:[7]}),o(l(y),{modelValue:a.organisation.country,readonly:""},null,8,["modelValue"])]),t("div",U,[o(l(g),{class:"font-semibold capitalize"},{default:n(()=>e[8]||(e[8]=[r("Kunde",-1)])),_:1,__:[8]}),o(l(S),{modelValue:a.organisation.customer,"onUpdate:modelValue":[e[0]||(e[0]=s=>a.organisation.customer=s),e[1]||(e[1]=s=>F())],class:"w-full"},{default:n(()=>[o(l($),{class:"col-span-3 w-full"},{default:n(()=>[o(l(w),{placeholder:a.organisation.customer?.name||"Vælg kunde"},null,8,["placeholder"])]),_:1}),o(l(O),null,{default:n(()=>[(m(!0),c(_,null,v(d.customers,s=>(m(),q(l(b),{key:s.id,value:s},{default:n(()=>[r(i(s.name)+" - "+i(s.email),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),t("div",H,[o(l(g),{class:"font-semibold capitalize"},{default:n(()=>e[9]||(e[9]=[r("Valuta",-1)])),_:1,__:[9]}),o(l(y),{modelValue:a.organisation.customer?.currency,readonly:""},null,8,["modelValue"])]),t("div",G,[o(l(g),{class:"font-semibold capitalize"},{default:n(()=>e[10]||(e[10]=[r("Type",-1)])),_:1,__:[10]}),o(l(S),{modelValue:a.organisation.type,"onUpdate:modelValue":e[2]||(e[2]=s=>a.organisation.type=s),class:"w-full"},{default:n(()=>[o(l($),{class:"col-span-3 w-full"},{default:n(()=>[o(l(w),{placeholder:"Select type"})]),_:1}),o(l(O),null,{default:n(()=>[o(l(b),{value:"organisation"},{default:n(()=>e[11]||(e[11]=[r("Organisation",-1)])),_:1,__:[11]}),o(l(b),{value:"forening/club"},{default:n(()=>e[12]||(e[12]=[r("Forening/Club",-1)])),_:1,__:[12]}),o(l(b),{value:"company"},{default:n(()=>e[13]||(e[13]=[r("Company",-1)])),_:1,__:[13]}),o(l(b),{value:"school"},{default:n(()=>e[14]||(e[14]=[r("School",-1)])),_:1,__:[14]})]),_:1})]),_:1},8,["modelValue"])])]),t("div",M,[t("div",Q,[e[16]||(e[16]=t("h2",{class:"font-semibold mb-2"},"Opgaveliste",-1)),t("table",W,[e[15]||(e[15]=t("thead",{class:"bg-gray-100 sticky top-0"},[t("tr",null,[t("th",{class:"p-2 text-left"},"Opgave"),t("th",null,"Status"),t("th",null,"Dato"),t("th",null,"Varighed"),t("th",null,"Sælger"),t("th",null,"Salgskode"),t("th",null,"Note")])],-1)),t("tbody",null,[(m(!0),c(_,null,v(z.value,(s,f)=>(m(),c("tr",{key:f,class:"border-t"},[t("td",Y,i(s.task),1),t("td",null,i(s.status),1),t("td",null,i(s.date),1),t("td",null,i(s.duration),1),t("td",null,i(s.seller),1),t("td",null,i(s.salesCode),1),t("td",null,i(s.note),1)]))),128))])])]),t("div",Z,[e[23]||(e[23]=t("h2",{class:"font-semibold mb-2"},"Kontakter",-1)),t("table",tt,[e[22]||(e[22]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"p-2 text-left"},"Kontaktperson"),t("th",{class:"p-2 text-left"},"Jobfunktion"),t("th",{class:"p-2 text-left"},"Telefon"),t("th",{class:"p-2 text-left"},"Email"),t("th",{class:"p-2 text-left"},"Handling")])],-1)),t("tbody",null,[t("tr",{class:V(["border-t",{"bg-green-100":a.organisation.contacts?.find(s=>s.cus_id===a.organisation.customer?.id&&s.is_primary)}])},[t("td",et,i(a.organisation.customer?.name),1),e[18]||(e[18]=t("td",{class:"p-2"},"Stripe bruger",-1)),e[19]||(e[19]=t("td",{class:"p-2"},"Ikke angivet",-1)),t("td",st,i(a.organisation.customer?.email||"Ikke angivet"),1),t("td",ot,[o(l(x),{variant:"outline",size:"sm",onClick:e[3]||(e[3]=s=>k(a.organisation.contacts?.find(f=>f.cus_id===a.organisation.customer?.id)?.id))},{default:n(()=>e[17]||(e[17]=[r(" Sæt primær ",-1)])),_:1,__:[17]})])],2),(m(!0),c(_,null,v(a.organisation.contacts,(s,f)=>(m(),c(_,{key:f},[s.cus_id!==a.organisation.customer.id?(m(),c("tr",{key:0,class:V(["border-t",{"bg-green-100":s.is_primary}])},[t("td",lt,i(s?.customer?.name??s.contact?.name),1),t("td",at,i(s.contact?.job??"Ikke angivet"),1),t("td",nt,i(s.contact?.phone??"Ikke angivet"),1),t("td",it,i(s.customer?.email??s.contact?.email??"Ikke angivet"),1),t("td",rt,[o(l(x),{variant:"outline",size:"sm",onClick:p=>k(s.id)},{default:n(()=>e[20]||(e[20]=[r("Sæt primær",-1)])),_:2,__:[20]},1032,["onClick"]),o(l(x),{variant:"destructive",size:"sm",onClick:p=>j(s.id)},{default:n(()=>e[21]||(e[21]=[r("Fjern",-1)])),_:2,__:[21]},1032,["onClick"])])],2)):C("",!0)],64))),128))])])]),t("div",dt,[e[24]||(e[24]=t("h2",{class:"font-semibold mb-2"},"Aftaler",-1)),N.value.length===0?(m(),c("div",ut,"Ingen aftaler")):C("",!0)])])])])]),_:1})],64))}});export{kt as default};
