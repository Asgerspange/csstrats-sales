import{c as A}from"./AppLayout.vue_vue_type_script_setup_true_lang-X8pwzv3H.js";import{d as K,r as C,a as f,o as c,b as s,f as a,n as q,w as n,e as t,t as r,i as d,F as p,g as x,h as B,x as V,l as S}from"./app-Cs27zE7g.js";import{_ as y}from"./Input.vue_vue_type_script_setup_true_lang-B2qJYlhi.js";import{_ as g}from"./Label.vue_vue_type_script_setup_true_lang-DUHwmjMR.js";import{_ as k}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CEHnIdfP.js";import{_ as $,a as w,b as O,c as z,d as b}from"./SelectValue.vue_vue_type_script_setup_true_lang-B6UDGpWV.js";import{_ as I}from"./CreateContactDialog.vue_vue_type_script_setup_true_lang-mP0tnoOB.js";import"./useForwardExpose-zHYqkc9M.js";import"./VisuallyHidden-DMYQV8Le.js";import"./chevron-down-Cn-U8CPF.js";import"./check-B-pvABCD.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-DJmM4mC8.js";import"./loader-circle-plLEH94g.js";const J={class:"flex flex-col p-4 overflow-x-auto h-full"},P={class:"text-2xl font-bold mb-4"},R={class:"grid grid-cols-1 lg:grid-cols-[2fr_3fr] gap-6 h-full"},X={class:"space-y-3 bg-white rounded-xl p-4 shadow"},D={class:"flex flex-col"},L={class:"flex flex-col"},U={class:"flex flex-col"},H={class:"flex flex-col"},G={class:"flex flex-col"},M={class:"flex flex-col"},Q={class:"flex flex-col"},W={class:"flex flex-col gap-6"},Y={class:"bg-white rounded-xl p-4 shadow flex-1 overflow-auto max-h-[400px]"},Z={class:"min-w-full border text-sm"},tt={class:"p-2"},et={class:"bg-white rounded-xl p-4 shadow"},ot={class:"flex justify-between mb-2 items-center"},st={class:"min-w-full border text-sm"},at={class:"p-2"},lt={class:"p-2"},nt={class:"p-2"},it={class:"p-2"},rt={class:"p-2"},dt={class:"p-2"},ut={class:"p-2"},mt={class:"p-2 flex gap-2"},ct={class:"bg-white rounded-xl p-4 shadow"},ft={key:0,class:"text-gray-500"},wt=K({__name:"Show",props:{organisation:{type:Object,required:!0},customers:{type:Array,required:!0}},setup(l){const i=l;let v=i.organisation.customer;console.log("Organisation:",i.organisation);const N=C([]),T=C([]),F=[{title:"Organisations",href:"/organisations"},{title:i.organisation.name,href:`/organisations/${i.organisation.id}`}],j=()=>{let u=i.organisation.customer;if(u){const e=v?.id;fetch(`/organisations/${i.organisation.id}/change-customer`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({cus_id:u.id})}).then(o=>{o.ok?(e&&(i.organisation.contacts=i.organisation.contacts.filter(m=>m.cus_id!==e)),v=u):i.organisation.customer=v}).catch(o=>{console.error("Error updating customer:",o),i.organisation.customer=v})}},h=u=>{if(i.organisation.contacts.find(o=>o.id===u).is_primary){console.log("Contact is already primary:",u);return}fetch(`/organisations/${i.organisation.id}/make-primary-contact`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({contact_id:u})}).then(o=>{if(o.ok){i.organisation.contacts.forEach(_=>{_.is_primary=!1});const m=i.organisation.contacts.find(_=>_.id===u);m&&(m.is_primary=!0)}else console.error("Failed to update primary contact")})},E=u=>{fetch(`/organisations/${i.organisation.id}/remove-contact`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({contact_id:u})})};return(u,e)=>(c(),f(p,null,[s(a(q),{title:`Organisation - ${l.organisation.name}`},null,8,["title"]),s(A,{breadcrumbs:F},{default:n(()=>[t("div",J,[t("h1",P,r(l.organisation.name),1),t("div",R,[t("div",X,[t("div",D,[s(a(g),{class:"font-semibold capitalize"},{default:n(()=>e[4]||(e[4]=[d("Navn",-1)])),_:1,__:[4]}),s(a(y),{modelValue:l.organisation.name,readonly:""},null,8,["modelValue"])]),t("div",L,[s(a(g),{class:"font-semibold capitalize"},{default:n(()=>e[5]||(e[5]=[d("CVR",-1)])),_:1,__:[5]}),s(a(y),{modelValue:l.organisation.cvr,readonly:""},null,8,["modelValue"])]),t("div",U,[s(a(g),{class:"font-semibold capitalize"},{default:n(()=>e[6]||(e[6]=[d("Adresse",-1)])),_:1,__:[6]}),s(a(y),{modelValue:`${l.organisation.address}, ${l.organisation.zip}`,readonly:""},null,8,["modelValue"])]),t("div",H,[s(a(g),{class:"font-semibold capitalize"},{default:n(()=>e[7]||(e[7]=[d("Land",-1)])),_:1,__:[7]}),s(a(y),{modelValue:l.organisation.country,readonly:""},null,8,["modelValue"])]),t("div",G,[s(a(g),{class:"font-semibold capitalize"},{default:n(()=>e[8]||(e[8]=[d("Kunde",-1)])),_:1,__:[8]}),s(a($),{modelValue:l.organisation.customer,"onUpdate:modelValue":[e[0]||(e[0]=o=>l.organisation.customer=o),e[1]||(e[1]=o=>j())],class:"w-full"},{default:n(()=>[s(a(w),{class:"col-span-3 w-full"},{default:n(()=>[s(a(O),{placeholder:l.organisation.customer?.name||"Vælg kunde"},null,8,["placeholder"])]),_:1}),s(a(z),null,{default:n(()=>[(c(!0),f(p,null,x(i.customers,o=>(c(),B(a(b),{key:o.id,value:o},{default:n(()=>[d(r(o.name)+" - "+r(o.email),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),t("div",M,[s(a(g),{class:"font-semibold capitalize"},{default:n(()=>e[9]||(e[9]=[d("Valuta",-1)])),_:1,__:[9]}),s(a(y),{modelValue:l.organisation.customer?.currency,readonly:""},null,8,["modelValue"])]),t("div",Q,[s(a(g),{class:"font-semibold capitalize"},{default:n(()=>e[10]||(e[10]=[d("Type",-1)])),_:1,__:[10]}),s(a($),{modelValue:l.organisation.type,"onUpdate:modelValue":e[2]||(e[2]=o=>l.organisation.type=o),class:"w-full"},{default:n(()=>[s(a(w),{class:"col-span-3 w-full"},{default:n(()=>[s(a(O),{placeholder:"Select type"})]),_:1}),s(a(z),null,{default:n(()=>[s(a(b),{value:"organisation"},{default:n(()=>e[11]||(e[11]=[d("Organisation",-1)])),_:1,__:[11]}),s(a(b),{value:"forening/club"},{default:n(()=>e[12]||(e[12]=[d("Forening/Club",-1)])),_:1,__:[12]}),s(a(b),{value:"company"},{default:n(()=>e[13]||(e[13]=[d("Company",-1)])),_:1,__:[13]}),s(a(b),{value:"school"},{default:n(()=>e[14]||(e[14]=[d("School",-1)])),_:1,__:[14]})]),_:1})]),_:1},8,["modelValue"])])]),t("div",W,[t("div",Y,[e[16]||(e[16]=t("h2",{class:"font-semibold mb-2"},"Opgaveliste",-1)),t("table",Z,[e[15]||(e[15]=t("thead",{class:"bg-gray-100 sticky top-0"},[t("tr",null,[t("th",{class:"p-2 text-left"},"Opgave"),t("th",null,"Status"),t("th",null,"Dato"),t("th",null,"Varighed"),t("th",null,"Sælger"),t("th",null,"Salgskode"),t("th",null,"Note")])],-1)),t("tbody",null,[(c(!0),f(p,null,x(N.value,(o,m)=>(c(),f("tr",{key:m,class:"border-t"},[t("td",tt,r(o.task),1),t("td",null,r(o.status),1),t("td",null,r(o.date),1),t("td",null,r(o.duration),1),t("td",null,r(o.seller),1),t("td",null,r(o.salesCode),1),t("td",null,r(o.note),1)]))),128))])])]),t("div",et,[t("div",ot,[e[17]||(e[17]=t("h2",{class:"font-semibold"},"Kontakter",-1)),s(a(I),{organisation:l.organisation},null,8,["organisation"])]),t("table",st,[e[23]||(e[23]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"p-2 text-left"},"Kontaktperson"),t("th",{class:"p-2 text-left"},"Jobfunktion"),t("th",{class:"p-2 text-left"},"Telefon"),t("th",{class:"p-2 text-left"},"Email"),t("th",{class:"p-2 text-left"},"Handling")])],-1)),t("tbody",null,[t("tr",{class:V(["border-t",{"bg-green-100":l.organisation.contacts?.find(o=>o.cus_id===l.organisation.customer?.id&&o.is_primary)}])},[t("td",at,r(l.organisation.customer?.name),1),e[19]||(e[19]=t("td",{class:"p-2"},"Stripe bruger",-1)),e[20]||(e[20]=t("td",{class:"p-2"},"Ikke angivet",-1)),t("td",lt,r(l.organisation.customer?.email||"Ikke angivet"),1),t("td",nt,[s(a(k),{variant:"outline",size:"sm",onClick:e[3]||(e[3]=o=>h(l.organisation.contacts?.find(m=>m.cus_id===l.organisation.customer?.id)?.id))},{default:n(()=>e[18]||(e[18]=[d(" Sæt primær ",-1)])),_:1,__:[18]})])],2),(c(!0),f(p,null,x(l.organisation.contacts,(o,m)=>(c(),f(p,{key:m},[o.cus_id!==l.organisation.customer.id?(c(),f("tr",{key:0,class:V(["border-t",{"bg-green-100":o.is_primary}])},[t("td",it,r(o?.customer?.name??o.contact?.name),1),t("td",rt,r(o.contact?.job??"Ikke angivet"),1),t("td",dt,r(o.contact?.phone??"Ikke angivet"),1),t("td",ut,r(o.customer?.email??o.contact?.email??"Ikke angivet"),1),t("td",mt,[s(a(k),{variant:"outline",size:"sm",onClick:_=>h(o.id)},{default:n(()=>e[21]||(e[21]=[d("Sæt primær",-1)])),_:2,__:[21]},1032,["onClick"]),s(a(k),{variant:"destructive",size:"sm",onClick:_=>E(o.id)},{default:n(()=>e[22]||(e[22]=[d("Fjern",-1)])),_:2,__:[22]},1032,["onClick"])])],2)):S("",!0)],64))),128))])])]),t("div",ct,[e[24]||(e[24]=t("h2",{class:"font-semibold mb-2"},"Aftaler",-1)),T.value.length===0?(c(),f("div",ft,"Ingen aftaler")):S("",!0)])])])])]),_:1})],64))}});export{wt as default};
