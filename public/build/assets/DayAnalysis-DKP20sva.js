import{_ as S}from"./AppLayout.vue_vue_type_script_setup_true_lang-u3AGF-01.js";import{d as V,c as m,r as b,m as T,a as i,o as c,b as s,e as n,h as W,w as l,f as e,g as r,t as d,F as w,i as O,k as I,j as L}from"./app-QQUxDZBe.js";import{_ as p,a as _,b as f,c as y}from"./CardTitle.vue_vue_type_script_setup_true_lang-D2LC_gyx.js";import{_ as M}from"./CardDescription.vue_vue_type_script_setup_true_lang-DAkdcl-z.js";import{_ as D}from"./index-Di-p_4DH.js";import{C as v,r as U}from"./chart-T7rvQP_M.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-EADfYvFp.js";import"./useForwardExpose-B28FEEy3.js";import"./VisuallyHidden-C2OGizoT.js";const q={class:"p-4 space-y-8"},z={key:0},G={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},H={class:"h-64"},J={class:"h-64"},K={class:"h-80 overflow-x-auto"},Q={class:"h-64"},X={class:"overflow-x-auto"},Y={class:"min-w-full text-sm border rounded overflow-hidden"},Z={class:"px-4 py-2"},tt={class:"px-4 py-2 text-muted-foreground"},et={class:"px-4 py-2"},at={class:"px-4 py-2 font-semibold"},st={class:"px-4 py-2"},nt={key:1,class:"text-muted-foreground"},lt={class:"px-4 py-2"},ft=V({__name:"DayAnalysis",props:{date:{},payments:{}},setup(N){v.register(...U);const o=N;m(()=>o.payments.reduce((a,t)=>a+t.amount,0));const B=m(()=>o.payments.filter(a=>a.coupon).length),R=m(()=>{const a={};for(const t of o.payments)a[t.plan_name]=(a[t.plan_name]||0)+t.amount;return a}),$=m(()=>{const a={};for(const t of o.payments)a[t.customer_name]=(a[t.customer_name]||0)+t.amount;return a}),F=m(()=>({due:o.payments.filter(a=>a.status==="due").length,scheduled:o.payments.filter(a=>a.status==="scheduled").length})),x=b(null),C=b(null),g=b(null),k=b(null);function h(){return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}T(()=>{x.value&&new v(x.value,{type:"doughnut",data:{labels:["With Coupon","Without Coupon"],datasets:[{data:[B.value,o.payments.length-B.value],backgroundColor:["#34D399","#3B82F6"]}]},options:h()}),C.value&&new v(C.value,{type:"bar",data:{labels:Object.keys(R.value),datasets:[{label:"Revenue by Plan",data:Object.values(R.value).map(a=>a/100),backgroundColor:"#F59E0B"}]},options:h()}),g.value&&new v(g.value,{type:"bar",data:{labels:Object.keys($.value),datasets:[{label:"Revenue per Customer",data:Object.values($.value).map(a=>a/100),backgroundColor:"#10B981"}]},options:{...h(),indexAxis:"y"}}),k.value&&new v(k.value,{type:"pie",data:{labels:["Due","Scheduled"],datasets:[{data:[F.value.due,F.value.scheduled],backgroundColor:["#EF4444","#3B82F6"]}]},options:h()})});function j(a,t){return new Intl.NumberFormat(void 0,{style:"currency",currency:t.toUpperCase()}).format(a/100)}const A=m(()=>{const a={};for(const t of o.payments)a[t.currency]=(a[t.currency]||0)+t.amount;return Object.entries(a)});return(a,t)=>(c(),i(w,null,[s(n(W),{title:`Analysis for ${o.date}`},null,8,["title"]),s(S,{breadcrumbs:[{title:"Billing",href:"/billing/calendar"},{title:o.date}]},{default:l(()=>[e("div",q,[s(n(p),null,{default:l(()=>[s(n(_),null,{default:l(()=>[s(n(f),null,{default:l(()=>[r("Daily Payment Analysis — "+d(o.date),1)]),_:1}),s(n(M),null,{default:l(()=>[t[0]||(t[0]=r(" Total Revenue: ",-1)),(c(!0),i(w,null,O(A.value,([u,P],E)=>(c(),i("span",{key:u},[e("strong",null,d(j(P,u)),1),E<A.value.length-1?(c(),i("span",z," · ")):I("",!0)]))),128)),r(" · "+d(o.payments.length)+" payments ",1)]),_:1,__:[0]})]),_:1}),s(n(y),{class:"space-y-8"},{default:l(()=>[e("div",G,[s(n(p),null,{default:l(()=>[s(n(_),null,{default:l(()=>[s(n(f),{class:"text-sm font-medium"},{default:l(()=>t[1]||(t[1]=[r("Coupons",-1)])),_:1,__:[1]})]),_:1}),s(n(y),null,{default:l(()=>[e("div",H,[e("canvas",{ref_key:"couponChart",ref:x},null,512)])]),_:1})]),_:1}),s(n(p),null,{default:l(()=>[s(n(_),null,{default:l(()=>[s(n(f),{class:"text-sm font-medium"},{default:l(()=>t[2]||(t[2]=[r("Revenue by Plan",-1)])),_:1,__:[2]})]),_:1}),s(n(y),null,{default:l(()=>[e("div",J,[e("canvas",{ref_key:"planChart",ref:C},null,512)])]),_:1})]),_:1}),s(n(p),null,{default:l(()=>[s(n(_),null,{default:l(()=>[s(n(f),{class:"text-sm font-medium"},{default:l(()=>t[3]||(t[3]=[r("Revenue per Customer",-1)])),_:1,__:[3]})]),_:1}),s(n(y),null,{default:l(()=>[e("div",K,[e("canvas",{ref_key:"customerChart",ref:g},null,512)])]),_:1})]),_:1}),s(n(p),null,{default:l(()=>[s(n(_),null,{default:l(()=>[s(n(f),{class:"text-sm font-medium"},{default:l(()=>t[4]||(t[4]=[r("Payment Status",-1)])),_:1,__:[4]})]),_:1}),s(n(y),null,{default:l(()=>[e("div",Q,[e("canvas",{ref_key:"statusChart",ref:k},null,512)])]),_:1})]),_:1})]),e("div",X,[e("table",Y,[t[5]||(t[5]=e("thead",{class:"bg-muted"},[e("tr",null,[e("th",{class:"px-4 py-2 text-left"},"Customer"),e("th",{class:"px-4 py-2 text-left"},"Email"),e("th",{class:"px-4 py-2 text-left"},"Plan"),e("th",{class:"px-4 py-2 text-left"},"Amount"),e("th",{class:"px-4 py-2 text-left"},"Coupon"),e("th",{class:"px-4 py-2 text-left"},"Status")])],-1)),e("tbody",null,[(c(!0),i(w,null,O(o.payments,u=>(c(),i("tr",{key:u.subscription_id,class:"border-t border-border"},[e("td",Z,d(u.customer_name),1),e("td",tt,d(u.customer_email),1),e("td",et,d(u.plan_name),1),e("td",at,d(j(u.amount,u.currency)),1),e("td",st,[u.coupon?(c(),L(n(D),{key:0,variant:"secondary"},{default:l(()=>[r(d(u.coupon),1)]),_:2},1024)):(c(),i("span",nt,"—"))]),e("td",lt,[s(n(D),{variant:u.status==="due"?"default":"outline"},{default:l(()=>[r(d(u.status),1)]),_:2},1032,["variant"])])]))),128))])])])]),_:1})]),_:1})])]),_:1},8,["breadcrumbs"])],64))}});export{ft as default};
