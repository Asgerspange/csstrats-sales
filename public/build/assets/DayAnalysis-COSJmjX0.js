import{c as V}from"./AppLayout.vue_vue_type_script_setup_true_lang-EgCfNpjb.js";import{d as T,c as m,r as b,A as W,a as i,o as c,b as s,f as l,n as I,w as n,e,i as r,t as d,F as w,g as j,l as L,h as M}from"./app-BeZTR5uq.js";import{c as p,_ as f,a as _,b as y}from"./CardTitle.vue_vue_type_script_setup_true_lang-DYcJBhEi.js";import{_ as U}from"./CardDescription.vue_vue_type_script_setup_true_lang-wCrcreAw.js";import{_ as D}from"./index-DuW0YDyc.js";import{C as v,r as q}from"./chart-T7rvQP_M.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-D17vN0to.js";import"./useForwardExpose-Df30Ukbt.js";import"./VisuallyHidden-m3mmf-zc.js";const z={class:"p-4 space-y-8"},G={key:0},H={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},J={class:"h-64"},K={class:"h-64"},Q={class:"h-80 overflow-x-auto"},X={class:"h-64"},Y={class:"overflow-x-auto"},Z={class:"min-w-full text-sm border rounded overflow-hidden"},tt={class:"px-4 py-2"},et={class:"px-4 py-2 text-muted-foreground"},at={class:"px-4 py-2"},st={class:"px-4 py-2 font-semibold"},lt={class:"px-4 py-2"},nt={key:1,class:"text-muted-foreground"},ot={class:"px-4 py-2"},yt=T({__name:"DayAnalysis",props:{date:{},payments:{}},setup(N){v.register(...q);const o=N;m(()=>o.payments.reduce((a,t)=>a+t.amount,0));const B=m(()=>o.payments.filter(a=>a.coupon).length),R=m(()=>{const a={};for(const t of o.payments)a[t.plan_name]=(a[t.plan_name]||0)+t.amount;return a}),$=m(()=>{const a={};for(const t of o.payments)a[t.customer_name]=(a[t.customer_name]||0)+t.amount;return a}),A=m(()=>({due:o.payments.filter(a=>a.status==="due").length,scheduled:o.payments.filter(a=>a.status==="scheduled").length})),x=b(null),g=b(null),C=b(null),k=b(null);function h(){return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}W(()=>{x.value&&new v(x.value,{type:"doughnut",data:{labels:["With Coupon","Without Coupon"],datasets:[{data:[B.value,o.payments.length-B.value],backgroundColor:["#34D399","#3B82F6"]}]},options:h()}),g.value&&new v(g.value,{type:"bar",data:{labels:Object.keys(R.value),datasets:[{label:"Revenue by Plan",data:Object.values(R.value).map(a=>a/100),backgroundColor:"#F59E0B"}]},options:h()}),C.value&&new v(C.value,{type:"bar",data:{labels:Object.keys($.value),datasets:[{label:"Revenue per Customer",data:Object.values($.value).map(a=>a/100),backgroundColor:"#10B981"}]},options:{...h(),indexAxis:"y"}}),k.value&&new v(k.value,{type:"pie",data:{labels:["Due","Scheduled"],datasets:[{data:[A.value.due,A.value.scheduled],backgroundColor:["#EF4444","#3B82F6"]}]},options:h()})});function F(a,t){return new Intl.NumberFormat(void 0,{style:"currency",currency:t.toUpperCase()}).format(a/100)}const O=m(()=>{const a={};for(const t of o.payments)a[t.currency]=(a[t.currency]||0)+t.amount;return Object.entries(a)}),P=[{title:"Billing",href:route("sales.billing.index")},{title:"Calendar",href:route("sales.billing.calendar")},{title:o.date,href:route("sales.billing.day",{date:o.date})}];return(a,t)=>(c(),i(w,null,[s(l(I),{title:`Analysis for ${o.date}`},null,8,["title"]),s(V,{breadcrumbs:P},{default:n(()=>[e("div",z,[s(l(p),null,{default:n(()=>[s(l(f),null,{default:n(()=>[s(l(_),null,{default:n(()=>[r("Daily Payment Analysis — "+d(o.date),1)]),_:1}),s(l(U),null,{default:n(()=>[t[0]||(t[0]=r(" Total Revenue: ",-1)),(c(!0),i(w,null,j(O.value,([u,E],S)=>(c(),i("span",{key:u},[e("strong",null,d(F(E,u)),1),S<O.value.length-1?(c(),i("span",G," · ")):L("",!0)]))),128)),r(" · "+d(o.payments.length)+" payments ",1)]),_:1,__:[0]})]),_:1}),s(l(y),{class:"space-y-8"},{default:n(()=>[e("div",H,[s(l(p),null,{default:n(()=>[s(l(f),null,{default:n(()=>[s(l(_),{class:"text-sm font-medium"},{default:n(()=>t[1]||(t[1]=[r("Coupons",-1)])),_:1,__:[1]})]),_:1}),s(l(y),null,{default:n(()=>[e("div",J,[e("canvas",{ref_key:"couponChart",ref:x},null,512)])]),_:1})]),_:1}),s(l(p),null,{default:n(()=>[s(l(f),null,{default:n(()=>[s(l(_),{class:"text-sm font-medium"},{default:n(()=>t[2]||(t[2]=[r("Revenue by Plan",-1)])),_:1,__:[2]})]),_:1}),s(l(y),null,{default:n(()=>[e("div",K,[e("canvas",{ref_key:"planChart",ref:g},null,512)])]),_:1})]),_:1}),s(l(p),null,{default:n(()=>[s(l(f),null,{default:n(()=>[s(l(_),{class:"text-sm font-medium"},{default:n(()=>t[3]||(t[3]=[r("Revenue per Customer",-1)])),_:1,__:[3]})]),_:1}),s(l(y),null,{default:n(()=>[e("div",Q,[e("canvas",{ref_key:"customerChart",ref:C},null,512)])]),_:1})]),_:1}),s(l(p),null,{default:n(()=>[s(l(f),null,{default:n(()=>[s(l(_),{class:"text-sm font-medium"},{default:n(()=>t[4]||(t[4]=[r("Payment Status",-1)])),_:1,__:[4]})]),_:1}),s(l(y),null,{default:n(()=>[e("div",X,[e("canvas",{ref_key:"statusChart",ref:k},null,512)])]),_:1})]),_:1})]),e("div",Y,[e("table",Z,[t[5]||(t[5]=e("thead",{class:"bg-muted"},[e("tr",null,[e("th",{class:"px-4 py-2 text-left"},"Customer"),e("th",{class:"px-4 py-2 text-left"},"Email"),e("th",{class:"px-4 py-2 text-left"},"Plan"),e("th",{class:"px-4 py-2 text-left"},"Amount"),e("th",{class:"px-4 py-2 text-left"},"Coupon"),e("th",{class:"px-4 py-2 text-left"},"Status")])],-1)),e("tbody",null,[(c(!0),i(w,null,j(o.payments,u=>(c(),i("tr",{key:u.subscription_id,class:"border-t border-border"},[e("td",tt,d(u.customer_name),1),e("td",et,d(u.customer_email),1),e("td",at,d(u.plan_name),1),e("td",st,d(F(u.amount,u.currency)),1),e("td",lt,[u.coupon?(c(),M(l(D),{key:0,variant:"secondary"},{default:n(()=>[r(d(u.coupon),1)]),_:2},1024)):(c(),i("span",nt,"—"))]),e("td",ot,[s(l(D),{variant:u.status==="due"?"default":"outline"},{default:n(()=>[r(d(u.status),1)]),_:2},1032,["variant"])])]))),128))])])])]),_:1})]),_:1})])]),_:1})],64))}});export{yt as default};
