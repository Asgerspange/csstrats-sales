import{u as E,_ as N,a as D,b as R,c as F}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dm-R0bL8.js";import{d as M,u as j,c as k,a as _,o as r,F as v,b as n,e as i,f as e,w as l,g as $,h as x,i as m,j as A,t as C,k as U,m as T,r as V,n as z,M as I}from"./app-BGRNuroF.js";import{_ as B,a as K,b as q,c as w,d as S,e as H}from"./TableHeader.vue_vue_type_script_setup_true_lang-DYGgvG1D.js";import{u as O,g as X,a as G}from"./index-DrEu-oDV.js";import{_ as L}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-LURPWeXY.js";import{_ as J}from"./Input.vue_vue_type_script_setup_true_lang-MYUkNLnO.js";import{_ as P}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-B3imMGkI.js";import{C as Q}from"./chevron-down-D9u7JIpd.js";import"./useForwardExpose-BF0rGXys.js";import"./VisuallyHidden-CVXYfjO4.js";import"./check-BKbCtaJA.js";const W={class:"flex items-center justify-between space-x-2 py-4"},Y={class:"flex items-center space-x-2"},Z=["value"],ee={class:"flex items-center space-x-2"},te={class:"text-sm text-gray-700"},se={class:"flex space-x-1"},ae=["disabled"],le=["disabled"],ne=["disabled"],oe=["disabled"],ie=M({__name:"MailTable",props:{filters:{},columns:{},mails:{}},setup(h){const{toast:b}=E(),c=h;j();const p=k(()=>c.mails||[]),g=k(()=>{let a=p.value||[];if(c.filters.searchTerm){const s=c.filters.searchTerm.toLowerCase();a=a.filter(o=>o.subject?.toLowerCase().includes(s)||o.sender?.name?.toLowerCase().includes(s)||o.sender?.email?.toLowerCase().includes(s)||o.recipients.some(d=>d.recipient_email.toLowerCase().includes(s)))}return a}),y=k(()=>c.columns.filter(a=>a.active).map(a=>({accessorKey:a.column,header:a.header,cell:({row:s})=>{const o=s.getValue(a.column);return a.column==="recipient_count"?s.original.recipients?.length||0:a.column==="status"?s.original.status.charAt(0).toUpperCase()+s.original.status.slice(1):a.column==="sent_at"&&s.original.sent_at?new Date(s.original.sent_at).toLocaleDateString():a.column==="created_at"?new Date(s.original.created_at).toLocaleDateString():o}}))),t=O({get data(){return g.value},get columns(){return y.value},getCoreRowModel:G(),getPaginationRowModel:X(),initialState:{pagination:{pageSize:10}}}),u=a=>{T.visit(route("mails.show",a.id))},f=a=>{fetch(`/mails/${a}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}}).then(s=>{s.ok?(b({title:"Mail Deleted",description:"The mail has been deleted successfully.",variant:"success"}),T.reload({only:["mails"]})):(b({title:"Failed to Delete Mail",description:"The mail could not be deleted.",variant:"destructive"}),console.error("Failed to delete mail"))})};return(a,s)=>(r(),_(v,null,[n(e(B),null,{default:l(()=>[n(e(K),null,{default:l(()=>[(r(!0),_(v,null,$(e(t).getHeaderGroups(),o=>(r(),x(e(S),{key:o.id},{default:l(()=>[(r(!0),_(v,null,$(o.headers,d=>(r(),x(e(H),{key:d.id},{default:l(()=>[m(C(d.isPlaceholder?"":d.column.columnDef.header),1)]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),n(e(q),null,{default:l(()=>[e(t).getRowModel().rows.length?(r(!0),_(v,{key:0},$(e(t).getRowModel().rows,o=>(r(),x(e(S),{key:o.id,onClick:d=>u(o.original),class:"cursor-pointer hover:bg-gray-100"},{default:l(()=>[(r(!0),_(v,null,$(o.getVisibleCells(),d=>(r(),x(e(w),{key:d.id},{default:l(()=>[m(C(d.getValue()),1)]),_:2},1024))),128)),n(e(w),null,{default:l(()=>[n(e(L),{size:"sm",variant:"outline",onClick:U(d=>f(o.original.id),["stop"])},{default:l(()=>s[5]||(s[5]=[m(" Delete ",-1)])),_:2,__:[5]},1032,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(r(),x(e(S),{key:1},{default:l(()=>[n(e(w),{colspan:y.value.length,class:"h-24 text-center"},{default:l(()=>s[6]||(s[6]=[m(" No mails found. ",-1)])),_:1,__:[6]},8,["colspan"])]),_:1}))]),_:1})]),_:1}),i("div",W,[i("div",Y,[s[8]||(s[8]=i("span",{class:"text-sm text-gray-700"},"Rows per page:",-1)),i("select",{value:e(t).getState().pagination.pageSize,onChange:s[0]||(s[0]=o=>e(t).setPageSize(Number(o.target.value))),class:"border rounded px-2 py-1"},s[7]||(s[7]=[A('<option value="5">5</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option>',5)]),40,Z)]),i("div",ee,[i("span",te," Page "+C(e(t).getState().pagination.pageIndex+1)+" of "+C(e(t).getPageCount())+" ("+C(e(t).getFilteredRowModel().rows.length)+" total rows) ",1),i("div",se,[i("button",{onClick:s[1]||(s[1]=o=>e(t).setPageIndex(0)),disabled:!e(t).getCanPreviousPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," First ",8,ae),i("button",{onClick:s[2]||(s[2]=o=>e(t).previousPage()),disabled:!e(t).getCanPreviousPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Previous ",8,le),i("button",{onClick:s[3]||(s[3]=o=>e(t).nextPage()),disabled:!e(t).getCanNextPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Next ",8,ne),i("button",{onClick:s[4]||(s[4]=o=>e(t).setPageIndex(e(t).getPageCount()-1)),disabled:!e(t).getCanNextPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Last ",8,oe)])])])],64))}}),re={class:"flex items-center gap-8"},ue={class:"flex items-center gap-4 w-full"},de=M({__name:"MailFilters",props:{filters:{},columns:{}},emits:["update:filters","update:columns"],setup(h,{emit:b}){const c=h,p=b,g=t=>{p("update:filters",{...c.filters,searchTerm:t})},y=(t,u)=>{const f=c.columns.map(a=>a.column===t?{...a,active:u}:a);p("update:columns",f)};return(t,u)=>(r(),_("div",re,[i("div",ue,[n(e(J),{"model-value":t.filters.searchTerm,"onUpdate:modelValue":g,type:"text",placeholder:"Search mails (Subject, Sender Name, Email)",class:"input input-bordered w-full max-w-xs"},null,8,["model-value"]),n(e(N),null,{default:l(()=>[n(e(D),{"as-child":""},{default:l(()=>[n(e(L),{variant:"outline"},{default:l(()=>[u[0]||(u[0]=m(" Columns ",-1)),n(e(Q),{class:"ml-2 h-4 w-4"})]),_:1,__:[0]})]),_:1}),n(e(R),{align:"end"},{default:l(()=>[(r(!0),_(v,null,$(t.columns,f=>(r(),x(e(P),{key:f.column,class:"capitalize","model-value":f.active,"onUpdate:modelValue":a=>y(f.column,a)},{default:l(()=>[m(C(f.header),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})])]))}}),ce={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 overflow-x-auto"},me={class:"flex items-center justify-between"},pe={class:"flex gap-4"},we=M({__name:"Index",props:{mails:{}},setup(h){const b=[{title:"Mails",href:"/mails"}],c=h,p=V({searchTerm:""}),g=V([{column:"subject",header:"Subject",active:!0,direction:"asc"},{column:"sender.name",header:"Sender",active:!0,direction:"asc"},{column:"status",header:"Status",active:!0,direction:"asc"},{column:"recipient_count",header:"Recipients",active:!0,direction:"asc"},{column:"sent_at",header:"Sent At",active:!0,direction:"asc"},{column:"created_at",header:"Created At",active:!0,direction:"asc"}]);return(y,t)=>(r(),_(v,null,[n(e(z),{title:"Mails"}),n(F,{breadcrumbs:b},{default:l(()=>[i("div",ce,[i("div",me,[t[6]||(t[6]=i("h1",{class:"text-2xl font-bold"},"Mails",-1)),i("div",pe,[n(e(I),{href:"/mails/create",class:"btn btn-primary"},{default:l(()=>t[2]||(t[2]=[m("New Email",-1)])),_:1,__:[2]}),n(e(N),null,{default:l(()=>[n(e(D),{"as-child":""},{default:l(()=>t[3]||(t[3]=[i("button",{class:"btn btn-primary"},"Actions",-1)])),_:1,__:[3]}),n(e(R),null,{default:l(()=>[n(e(P),{checked:""},{default:l(()=>t[4]||(t[4]=[m("Export CSV",-1)])),_:1,__:[4]}),n(e(P),null,{default:l(()=>t[5]||(t[5]=[m("Import CSV",-1)])),_:1,__:[5]})]),_:1})]),_:1})])]),n(e(de),{filters:p.value,"onUpdate:filters":t[0]||(t[0]=u=>p.value=u),columns:g.value,"onUpdate:columns":t[1]||(t[1]=u=>g.value=u)},null,8,["filters","columns"]),n(e(ie),{filters:p.value,columns:g.value,mails:c.mails},null,8,["filters","columns","mails"])])]),_:1})],64))}});export{we as default};
