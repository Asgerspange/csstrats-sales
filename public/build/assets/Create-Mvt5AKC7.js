import{u as ie,c as oe}from"./AppLayout.vue_vue_type_script_setup_true_lang-CfpExTNj.js";import{C as A,d as Y,H as re,r as Z,A as ee,I as le,J as se,K as ue,v as K,E as z,u as de,L as fe,a as D,o as E,b as o,f as a,n as ce,w as s,e as C,i as c,F as M,g as F,h as G,t as H,m as L}from"./app-rA5uPXP2.js";import{_ as U}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Cc-qQp-T.js";import{_ as q}from"./Input.vue_vue_type_script_setup_true_lang-DtkOVXx-.js";import{_ as P}from"./Label.vue_vue_type_script_setup_true_lang-CxR6tPK2.js";import{c as me,_ as ve,a as pe,b as _e}from"./CardTitle.vue_vue_type_script_setup_true_lang-B5koauAf.js";import{_ as ye}from"./CardDescription.vue_vue_type_script_setup_true_lang-WseC6fTU.js";import{_ as O,a as R,b as $,c as I,d as h}from"./SelectValue.vue_vue_type_script_setup_true_lang-DRdLwAPf.js";import"./useForwardExpose-DjSHLXxA.js";import"./VisuallyHidden-De8-eOj1.js";import"./chevron-down-L9TwnZIA.js";import"./check-Cu7iVvqE.js";import"./useFormControl-DOtrYntd.js";var ge=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCommentChange","onCompositionEnd","onCompositionStart","onCompositionUpdate","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onInput","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],be=function(e){return ge.map(function(n){return n.toLowerCase()}).indexOf(e.toLowerCase())!==-1},Ce=function(e,n,i){Object.keys(n).filter(be).forEach(function(u){var d=n[u];typeof d=="function"&&(u==="onInit"?d(e,i):i.on(u.substring(2),function(v){return d(v,i)}))})},Se=function(e,n,i,u){var d=e.modelEvents?e.modelEvents:null,v=Array.isArray(d)?d.join(" "):d;A(u,function(m,l){i&&typeof m=="string"&&m!==l&&m!==i.getContent({format:e.outputFormat})&&i.setContent(m)}),i.on(v||"change input undo redo",function(){n.emit("update:modelValue",i.getContent({format:e.outputFormat}))})},Ve=function(e,n,i,u,d,v){u.setContent(v()),i.attrs["onUpdate:modelValue"]&&Se(n,i,u,d),Ce(e,i.attrs,u)},X=0,te=function(e){var n=Date.now(),i=Math.floor(Math.random()*1e9);return X++,e+"_"+i+X+String(n)},Ee=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},J=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},he=function(e,n){return J(e).concat(J(n))},je=function(e){return e==null},W=function(e){var n;return typeof((n=e.options)===null||n===void 0?void 0:n.set)=="function"&&e.options.isRegistered("disabled")},Q=function(){return{listeners:[],scriptId:te("tiny-script"),scriptLoaded:!1}},we=function(){var e=Q(),n=function(d,v,m,l){var p=v.createElement("script");p.referrerPolicy="origin",p.type="application/javascript",p.id=d,p.src=m;var f=function(){p.removeEventListener("load",f),l()};p.addEventListener("load",f),v.head&&v.head.appendChild(p)},i=function(d,v,m){e.scriptLoaded?m():(e.listeners.push(m),d.getElementById(e.scriptId)||n(e.scriptId,d,v,function(){e.listeners.forEach(function(l){return l()}),e.scriptLoaded=!0}))},u=function(){e=Q()};return{load:i,reinitialize:u}},Pe=we(),ke=function(){return typeof window<"u"?window:global},j=function(){var e=ke();return e&&e.tinymce?e.tinymce:null},xe={apiKey:String,licenseKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,readonly:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},V=function(){return V=Object.assign||function(e){for(var n,i=1,u=arguments.length;i<u;i++){n=arguments[i];for(var d in n)Object.prototype.hasOwnProperty.call(n,d)&&(e[d]=n[d])}return e},V.apply(this,arguments)},De=function(e,n,i,u){return e(u||"div",{id:n,ref:i})},Ue=function(e,n,i){return e("textarea",{id:n,visibility:"hidden",ref:i})},T={selector:void 0,target:void 0},N=function(e,n){var i;typeof((i=e.mode)===null||i===void 0?void 0:i.set)=="function"?e.mode.set(n):e.setMode(n)},Ae=Y({props:xe,setup:function(e,n){var i=e.init?V(V({},e.init),T):V({},T),u=re(e),d=u.disabled,v=u.readonly,m=u.modelValue,l=u.tagName,p=Z(null),f=null,B=e.id||te("tiny-vue"),k=e.init&&e.init.inline||e.inline,x=!!n.attrs["onUpdate:modelValue"],y=!0,t=e.initialValue?e.initialValue:"",r="",g=function(_){return x?function(){return m?.value?m.value:""}:function(){return _?t:r}},S=function(){var _=g(y),b=V(V({},i),{disabled:e.disabled,readonly:e.readonly,target:p.value,plugins:he(i.plugins,e.plugins),toolbar:e.toolbar||i.toolbar,inline:k,license_key:e.licenseKey,setup:function(w){f=w,!W(f)&&e.disabled===!0&&N(f,"readonly"),w.on("init",function(ae){return Ve(ae,e,n,w,m,_)}),typeof i.setup=="function"&&i.setup(w)}});Ee(p.value)&&(p.value.style.visibility=""),j().init(b),y=!1};A(v,function(_){f!==null&&N(f,_?"readonly":"design")}),A(d,function(_){f!==null&&(W(f)?f.options.set("disabled",_):N(f,_?"readonly":"design"))}),A(l,function(_){var b;f&&(x||(r=f.getContent()),(b=j())===null||b===void 0||b.remove(f),z(function(){return S()}))}),ee(function(){if(j()!==null)S();else if(p.value&&p.value.ownerDocument){var _=e.cloudChannel?e.cloudChannel:"8",b=e.apiKey?e.apiKey:"no-api-key",w=je(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(b,"/tinymce/").concat(_,"/tinymce.min.js"):e.tinymceScriptSrc;Pe.load(p.value.ownerDocument,w,S)}}),le(function(){j()!==null&&j().remove(f)}),k||(se(function(){y||S()}),ue(function(){var _;f&&(x||(r=f.getContent()),(_=j())===null||_===void 0||_.remove(f))}));var ne=function(_){var b;f&&(r=f.getContent(),(b=j())===null||b===void 0||b.remove(f),i=V(V(V({},i),_),T),z(function(){return S()}))};return n.expose({rerender:ne,getEditor:function(){return f}}),function(){return k?De(K,B,p,e.tagName):Ue(K,B,p)}}});const Be={class:"container mx-auto p-4"},Me={class:"space-y-2"},Oe={class:"space-y-2"},Re={class:"space-y-2"},$e={class:"space-y-4"},Ie={class:"flex-1 w-full"},Fe={class:"w-full sm:w-32"},Le={class:"flex items-center justify-center mt-4 sm:mt-0"},Te={class:"space-y-2"},Ne={class:"flex flex-wrap gap-3"},Ke=Y({__name:"Create",setup(e){const{toast:n}=ie(),i=[{title:"Mails",href:"/mails"},{title:"Create Mail",href:"/mails/create"}],u=de();u.props.auth.user;const d=u.props.recipientGroups||{},v=u.props.fromEmails||[];console.log(d);const m=Z(),l=fe({from_email:"",subject:"",body:"",recipients:[{email:"",name:"",type:"to"}],status:"draft"}),p={height:400,menubar:!1,plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","help","wordcount"],toolbar:"undo redo | blocks | bold italic forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"},f=()=>{l.recipients.push({email:"",name:"",type:"to"})},B=y=>{l.recipients.length>1&&l.recipients.splice(y,1)},k=()=>{if(!l.from_email.trim()){n({title:"Validation Error",description:"Please select a from email address.",variant:"destructive"});return}if(!l.subject.trim()){n({title:"Validation Error",description:"Please enter a subject for the email.",variant:"destructive"});return}if(!l.body.trim()){n({title:"Validation Error",description:"Please enter the email body.",variant:"destructive"});return}const y=l.recipients.filter(r=>r.email.trim()!=="");if(y.length===0){n({title:"Validation Error",description:"Please add at least one recipient.",variant:"destructive"});return}const t={from_email:l.from_email,subject:l.subject,body:l.body,recipients:y,status:l.status};L.post("/mails",t,{onSuccess:()=>{n({title:"Email Saved",description:"The email has been saved successfully.",variant:"success"}),L.visit("/mails")},onError:r=>{console.error("Submission errors:",r),n({title:"Error",description:"Failed to save the email. Please try again.",variant:"destructive"})}})},x=()=>{if(l.status="sent",!l.from_email.trim()){n({title:"Validation Error",description:"Please select a from email address before sending.",variant:"destructive"});return}const y=l.recipients.filter(r=>r.email.trim()!=="");if(y.length===0){n({title:"Validation Error",description:"Please add at least one recipient before sending.",variant:"destructive"});return}const t={from_email:l.from_email,subject:l.subject,body:l.body,recipients:y,status:"sent"};fetch("/mails",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-Inertia":"true","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(t),credentials:"same-origin"}).then(async r=>{if(r.ok)n({title:"Email Sent",description:"The email has been sent successfully.",variant:"success"}),L.visit("/mails");else{const g=await r.json();console.error("Submission errors:",g),n({title:"Error",description:"Failed to send the email. Please try again.",variant:"destructive"})}}).catch(r=>{console.error("Fetch error:",r),n({title:"Error",description:"Failed to send the email. Please try again.",variant:"destructive"})})};return ee(()=>{v.length>0&&(l.from_email=v[0].email)}),A(m,y=>{const t=d[y];t&&(l.recipients=t.map(r=>({email:r.email,name:"",type:"to"})))}),(y,t)=>(E(),D(M,null,[o(a(ce),{title:"Create Mail"}),o(oe,{breadcrumbs:i},{default:s(()=>[C("div",Be,[o(a(me),{class:"max-w-6xl mx-auto"},{default:s(()=>[o(a(ve),null,{default:s(()=>[o(a(pe),null,{default:s(()=>t[6]||(t[6]=[c("Create New Email",-1)])),_:1,__:[6]}),o(a(ye),null,{default:s(()=>t[7]||(t[7]=[c(" Compose and send your email or save as draft ",-1)])),_:1,__:[7]})]),_:1}),o(a(_e),{class:"space-y-6"},{default:s(()=>[C("div",Me,[o(a(P),{for:"from_email"},{default:s(()=>t[8]||(t[8]=[c("From",-1)])),_:1,__:[8]}),o(a(O),{modelValue:l.from_email,"onUpdate:modelValue":t[0]||(t[0]=r=>l.from_email=r)},{default:s(()=>[o(a(R),null,{default:s(()=>[o(a($),{placeholder:"Select from email address"})]),_:1}),o(a(I),null,{default:s(()=>[(E(!0),D(M,null,F(a(v),r=>(E(),G(a(h),{key:r.email,value:r.email},{default:s(()=>[c(H(r.name?`${r.name} <${r.email}>`:r.email),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),C("div",Oe,[o(a(P),{for:"subject"},{default:s(()=>t[9]||(t[9]=[c("Subject",-1)])),_:1,__:[9]}),o(a(q),{id:"subject",modelValue:l.subject,"onUpdate:modelValue":t[1]||(t[1]=r=>l.subject=r),placeholder:"Enter email subject",type:"text"},null,8,["modelValue"])]),C("div",Re,[o(a(P),{for:"body"},{default:s(()=>t[10]||(t[10]=[c("Email Body",-1)])),_:1,__:[10]}),o(a(Ae),{"api-key":"tic9eoey0yqym7o9izvje3s99krk6ye0tda2zol2ark110dl",modelValue:l.body,"onUpdate:modelValue":t[2]||(t[2]=r=>l.body=r),init:p,class:"border rounded-lg"},null,8,["modelValue"])]),C("div",$e,[t[18]||(t[18]=C("h3",{class:"text-lg font-semibold"},"Recipients",-1)),(E(!0),D(M,null,F(l.recipients,(r,g)=>(E(),D("div",{key:g,class:"flex flex-col sm:flex-row gap-2 items-start sm:items-center p-3 border rounded-lg"},[C("div",Ie,[o(a(P),{for:"email"},{default:s(()=>t[11]||(t[11]=[c("Email Address",-1)])),_:1,__:[11]}),o(a(q),{id:"email-"+g,modelValue:r.email,"onUpdate:modelValue":S=>r.email=S,placeholder:"recipient@example.com",type:"email"},null,8,["id","modelValue","onUpdate:modelValue"])]),C("div",Fe,[o(a(P),{for:"type"},{default:s(()=>t[12]||(t[12]=[c("Type",-1)])),_:1,__:[12]}),o(a(O),{modelValue:r.type,"onUpdate:modelValue":S=>r.type=S},{default:s(()=>[o(a(R),null,{default:s(()=>[o(a($),{placeholder:"Select type"})]),_:1}),o(a(I),null,{default:s(()=>[o(a(h),{value:"to"},{default:s(()=>t[13]||(t[13]=[c("To",-1)])),_:1,__:[13]}),o(a(h),{value:"cc"},{default:s(()=>t[14]||(t[14]=[c("CC",-1)])),_:1,__:[14]}),o(a(h),{value:"bcc"},{default:s(()=>t[15]||(t[15]=[c("BCC",-1)])),_:1,__:[15]})]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),C("div",Le,[o(a(U),{type:"button",variant:"destructive",size:"sm",onClick:S=>B(g),disabled:l.recipients.length<=1},{default:s(()=>t[16]||(t[16]=[c(" Remove ",-1)])),_:2,__:[16]},1032,["onClick","disabled"])])]))),128)),o(a(U),{type:"button",variant:"outline",onClick:f},{default:s(()=>t[17]||(t[17]=[c(" Add Recipient ",-1)])),_:1,__:[17]}),o(a(O),{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=r=>m.value=r)},{default:s(()=>[o(a(R),null,{default:s(()=>[o(a($),{placeholder:"Select group"})]),_:1}),o(a(I),null,{default:s(()=>[(E(!0),D(M,null,F(a(d),(r,g)=>(E(),G(a(h),{key:g,value:g},{default:s(()=>[c(H(g),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),C("div",Te,[o(a(P),{for:"status"},{default:s(()=>t[19]||(t[19]=[c("Status",-1)])),_:1,__:[19]}),o(a(O),{modelValue:l.status,"onUpdate:modelValue":t[4]||(t[4]=r=>l.status=r)},{default:s(()=>[o(a(R),null,{default:s(()=>[o(a($),{placeholder:"Select status"})]),_:1}),o(a(I),null,{default:s(()=>[o(a(h),{value:"draft"},{default:s(()=>t[20]||(t[20]=[c("Draft",-1)])),_:1,__:[20]}),o(a(h),{value:"sent"},{default:s(()=>t[21]||(t[21]=[c("Sent",-1)])),_:1,__:[21]})]),_:1})]),_:1},8,["modelValue"])]),C("div",Ne,[o(a(U),{type:"button",onClick:k,variant:"default"},{default:s(()=>t[22]||(t[22]=[c(" Save as Draft ",-1)])),_:1,__:[22]}),o(a(U),{type:"button",onClick:x,variant:"success"},{default:s(()=>t[23]||(t[23]=[c(" Send Email ",-1)])),_:1,__:[23]}),o(a(U),{type:"button",variant:"secondary",onClick:t[5]||(t[5]=r=>y.$router.visit("/mails"))},{default:s(()=>t[24]||(t[24]=[c(" Cancel ",-1)])),_:1,__:[24]})])]),_:1})]),_:1})])]),_:1})],64))}}),ze=(e,n)=>{const i=e.__vccOpts||e;for(const[u,d]of n)i[u]=d;return i},it=ze(Ke,[["__scopeId","data-v-d965f794"]]);export{it as default};
