import{u as j,_ as D,a as A,b as E,c as K}from"./AppLayout.vue_vue_type_script_setup_true_lang-ByekdlE7.js";import{d as R,u as q,c as U,r as S,a as x,o as m,F as $,b as a,e as d,f as e,w as s,g as h,h as C,i as u,j as Z,t as V,k as X,l as I,m as L,n as H}from"./app-BmUQyhEG.js";import{u as J,_ as G,a as Q,b as W,c as z,d as F,e as Y,g as ee,f as te}from"./index-DME__2AA.js";import{_ as P}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CQpPzbbc.js";import{L as B}from"./loader-circle-Dovhu6oG.js";import{_ as k}from"./Input.vue_vue_type_script_setup_true_lang-8-D0aQVt.js";import{_ as ae}from"./Checkbox.vue_vue_type_script_setup_true_lang-DdSaJx0q.js";import{_ as T}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-DTiBLAbY.js";import{C as M}from"./chevron-down-BB7CWAMk.js";import{_ as se,a as le,b as ne,c as oe,d as ie,e as re,f as de}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bbc3owDB.js";import{_ as O}from"./Label.vue_vue_type_script_setup_true_lang-Ctwy-M8u.js";import{_ as ue,a as ce,b as me,c as pe,d as N}from"./SelectValue.vue_vue_type_script_setup_true_lang-Db5aoPQf.js";import"./useForwardExpose-Njt58a_Z.js";import"./VisuallyHidden-C1q9v5dU.js";import"./check-BwXhmyDF.js";const fe={class:"flex items-center justify-between space-x-2 py-4"},ge={class:"flex items-center space-x-2"},_e=["value"],ve={class:"flex items-center space-x-2"},ye={class:"text-sm text-gray-700"},be={class:"flex space-x-1"},Ce=["disabled"],xe=["disabled"],$e=["disabled"],Ve=["disabled"],we=R({__name:"OrganisationTable",props:{filters:{},columns:{}},setup(w){const{toast:_}=j(),o=w,p=q(),v=U(()=>p.props.organisations||[]),b=U(()=>{let n=v.value||[];if(o.filters.searchTerm){const i=o.filters.searchTerm.toLowerCase();n=n.filter(y=>y.name?.toLowerCase().includes(i)||y.cvr?.toLowerCase().includes(i))}o.filters.danishOnly&&(n=n.filter(i=>i.country.toLowerCase()==="dk"));const r=o.filters.countries.filter(i=>i.active).map(i=>i.country);return r.length>0&&r.length<o.filters.countries.length&&(n=n.filter(i=>r.includes(i.country))),n}),c=U(()=>o.columns.filter(n=>n.active).map(n=>({accessorKey:n.column,header:n.header,cell:({row:r})=>r.getValue(n.column)}))),t=J({get data(){return b.value},get columns(){return c.value},getCoreRowModel:te(),getPaginationRowModel:ee(),initialState:{pagination:{pageSize:10}}}),l=S(null),g=n=>{L.visit(route("organisations.show",n.id))},f=n=>{l.value=n,fetch(`organisations/${n}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}}).then(r=>{r.ok?(_({title:"Organisation Deleted",description:"The organisation has been deleted successfully.",variant:"success"}),L.reload({only:["organisations"]})):(_({title:"Failed to Delete Organisation",description:"The organisation could not be deleted.",variant:"destructive"}),console.error("Failed to delete organisation"))})};return(n,r)=>(m(),x($,null,[a(e(G),null,{default:s(()=>[a(e(Q),null,{default:s(()=>[(m(!0),x($,null,h(e(t).getHeaderGroups(),i=>(m(),C(e(F),{key:i.id},{default:s(()=>[(m(!0),x($,null,h(i.headers,y=>(m(),C(e(Y),{key:y.id},{default:s(()=>[u(V(y.isPlaceholder?"":y.column.columnDef.header),1)]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),a(e(W),null,{default:s(()=>[e(t).getRowModel().rows.length?(m(!0),x($,{key:0},h(e(t).getRowModel().rows,i=>(m(),C(e(F),{key:i.id,onClick:y=>g(i.original),class:"cursor-pointer hover:bg-gray-100"},{default:s(()=>[(m(!0),x($,null,h(i.getVisibleCells(),y=>(m(),C(e(z),{key:y.id},{default:s(()=>[u(V(y.getValue()),1)]),_:2},1024))),128)),a(e(z),null,{default:s(()=>[a(e(P),{size:"sm",variant:"destructive",onClick:X(y=>f(i.original.id),["stop"]),disabled:l.value===i.original.id},{default:s(()=>[l.value===i.original.id?(m(),C(e(B),{key:0,class:"h-4 w-4 animate-spin"})):I("",!0),r[5]||(r[5]=u(" Delete ",-1))]),_:2,__:[5]},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(m(),C(e(F),{key:1},{default:s(()=>[a(e(z),{colspan:c.value.length,class:"h-24 text-center"},{default:s(()=>r[6]||(r[6]=[u(" No organisations found. ",-1)])),_:1,__:[6]},8,["colspan"])]),_:1}))]),_:1})]),_:1}),d("div",fe,[d("div",ge,[r[8]||(r[8]=d("span",{class:"text-sm text-gray-700"},"Rows per page:",-1)),d("select",{value:e(t).getState().pagination.pageSize,onChange:r[0]||(r[0]=i=>e(t).setPageSize(Number(i.target.value))),class:"border rounded px-2 py-1"},r[7]||(r[7]=[Z('<option value="5">5</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option>',5)]),40,_e)]),d("div",ve,[d("span",ye," Page "+V(e(t).getState().pagination.pageIndex+1)+" of "+V(e(t).getPageCount())+" ("+V(e(t).getFilteredRowModel().rows.length)+" total rows) ",1),d("div",be,[d("button",{onClick:r[1]||(r[1]=i=>e(t).setPageIndex(0)),disabled:!e(t).getCanPreviousPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," First ",8,Ce),d("button",{onClick:r[2]||(r[2]=i=>e(t).previousPage()),disabled:!e(t).getCanPreviousPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Previous ",8,xe),d("button",{onClick:r[3]||(r[3]=i=>e(t).nextPage()),disabled:!e(t).getCanNextPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Next ",8,$e),d("button",{onClick:r[4]||(r[4]=i=>e(t).setPageIndex(e(t).getPageCount()-1)),disabled:!e(t).getCanNextPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Last ",8,Ve)])])])],64))}}),Oe={class:"flex items-center gap-8"},ke={class:"flex items-center gap-4 w-full"},he={class:"flex items-center gap-2"},Se=R({__name:"OrganisationFilters",props:{filters:{},columns:{}},emits:["update:filters","update:columns"],setup(w,{emit:_}){const o=w,p=_,v=l=>{p("update:filters",{...o.filters,searchTerm:l})},b=l=>{p("update:filters",{...o.filters,danishOnly:l})},c=(l,g)=>{const f=o.columns.map(n=>n.column===l?{...n,active:g}:n);p("update:columns",f)},t=(l,g)=>{const f=o.filters.countries.map(n=>n.country===l?{...n,active:g}:n);p("update:filters",{...o.filters,countries:f})};return(l,g)=>(m(),x("div",Oe,[d("div",ke,[a(e(k),{"model-value":l.filters.searchTerm,"onUpdate:modelValue":v,type:"text",placeholder:"Search organisations (Name, CVR)",class:"input input-bordered w-full max-w-xs"},null,8,["model-value"]),a(e(D),null,{default:s(()=>[a(e(A),{"as-child":""},{default:s(()=>[a(e(P),{variant:"outline"},{default:s(()=>[g[0]||(g[0]=u(" Columns ",-1)),a(e(M),{class:"ml-2 h-4 w-4"})]),_:1,__:[0]})]),_:1}),a(e(E),{align:"end"},{default:s(()=>[(m(!0),x($,null,h(l.columns,f=>(m(),C(e(T),{key:f.column,class:"capitalize","model-value":f.active,"onUpdate:modelValue":n=>c(f.column,n)},{default:s(()=>[u(V(f.header),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1}),a(e(D),null,{default:s(()=>[a(e(A),{"as-child":""},{default:s(()=>[a(e(P),{variant:"outline"},{default:s(()=>[g[1]||(g[1]=u(" Countries ",-1)),a(e(M),{class:"ml-2 h-4 w-4"})]),_:1,__:[1]})]),_:1}),a(e(E),{align:"end"},{default:s(()=>[(m(!0),x($,null,h(l.filters.countries,f=>(m(),C(e(T),{key:f.country,class:"capitalize","model-value":f.active,"onUpdate:modelValue":n=>t(f.country,n)},{default:s(()=>[u(V(f.country),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1}),d("div",he,[a(e(ae),{"model-value":l.filters.danishOnly,"onUpdate:modelValue":b,class:"ml-4"},null,8,["model-value"]),g[2]||(g[2]=d("label",null,"Danish only",-1))])])]))}}),Pe={class:"grid gap-4 py-4"},Ne={class:"grid grid-cols-4 items-center gap-4"},Te={class:"grid grid-cols-4 items-center gap-4"},Re={class:"grid grid-cols-4 items-center gap-4"},Ue={class:"grid grid-cols-4 items-center gap-4"},ze={class:"grid grid-cols-4 items-center gap-4"},Fe={class:"grid grid-cols-4 items-center gap-4"},De=R({__name:"CreateOrganisationDialog",setup(w){const{toast:_}=j(),o=S({name:"",cvr:"",country:"",address:"",zip:"",type:""}),p=S(!1),v=S(!1),b=async()=>{p.value=!0;const c={...o.value,country:o.value.country.toUpperCase()};try{const t=await fetch("organisations",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(c)});if(t.status===201){const l=await t.json();_({title:"Organisation Created",description:`${l.organisation.name} has been created successfully.`,variant:"success"}),o.value={name:"",cvr:"",country:"",address:"",type:"",zip:""},v.value=!1,L.reload({only:["organisations"]})}else if(t.status===409)_({title:"CVR Already Exists",description:`${c.name} could not be created because the CVR already exists.`,variant:"destructive"});else{const l=await t.json();_({title:"Organisation Creation Failed",description:l?.message||"Organisation could not be created.",variant:"destructive"})}}catch{_({title:"Error",description:"An unexpected error occurred.",variant:"destructive"})}finally{p.value=!1}};return(c,t)=>(m(),C(e(de),{open:v.value,"onUpdate:open":t[7]||(t[7]=l=>v.value=l)},{default:s(()=>[a(e(se),{"as-child":""},{default:s(()=>[a(e(P),{variant:"success"},{default:s(()=>t[8]||(t[8]=[u("New Organisation",-1)])),_:1,__:[8]})]),_:1}),a(e(le),{class:"sm:max-w-[425px]"},{default:s(()=>[a(e(ne),null,{default:s(()=>[a(e(oe),null,{default:s(()=>t[9]||(t[9]=[u("New Organisation",-1)])),_:1,__:[9]}),a(e(ie),null,{default:s(()=>t[10]||(t[10]=[u(" Fill in the organisation details below and click save. ",-1)])),_:1,__:[10]})]),_:1}),d("div",Pe,[d("div",Ne,[a(e(O),{for:"name",class:"text-right"},{default:s(()=>t[11]||(t[11]=[u("Name",-1)])),_:1,__:[11]}),a(e(k),{id:"name",placeholder:"Organisation Name",class:"col-span-3",modelValue:o.value.name,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value.name=l)},null,8,["modelValue"])]),d("div",Te,[a(e(O),{for:"cvr",class:"text-right"},{default:s(()=>t[12]||(t[12]=[u("CVR",-1)])),_:1,__:[12]}),a(e(k),{id:"cvr",placeholder:"12345678",class:"col-span-3",modelValue:o.value.cvr,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.cvr=l)},null,8,["modelValue"])]),d("div",Re,[a(e(O),{for:"country",class:"text-right"},{default:s(()=>t[13]||(t[13]=[u("Country",-1)])),_:1,__:[13]}),a(e(k),{id:"country",placeholder:"DK",maxlength:"2",class:"col-span-3 uppercase",modelValue:o.value.country,"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.country=l)},null,8,["modelValue"])]),d("div",Ue,[a(e(O),{for:"address",class:"text-right"},{default:s(()=>t[14]||(t[14]=[u("Address",-1)])),_:1,__:[14]}),a(e(k),{id:"address",placeholder:"Street, City, Zip",class:"col-span-3",modelValue:o.value.address,"onUpdate:modelValue":t[3]||(t[3]=l=>o.value.address=l)},null,8,["modelValue"])]),d("div",ze,[a(e(O),{for:"zip",class:"text-right"},{default:s(()=>t[15]||(t[15]=[u("Zip",-1)])),_:1,__:[15]}),a(e(k),{id:"zip",placeholder:"Zip Code",class:"col-span-3",modelValue:o.value.zip,"onUpdate:modelValue":t[4]||(t[4]=l=>o.value.zip=l)},null,8,["modelValue"])]),d("div",Fe,[a(e(O),{class:"text-right"},{default:s(()=>t[16]||(t[16]=[u("Type",-1)])),_:1,__:[16]}),a(e(ue),{modelValue:o.value.type,"onUpdate:modelValue":t[5]||(t[5]=l=>o.value.type=l),class:"w-100"},{default:s(()=>[a(e(ce),{class:"col-span-3"},{default:s(()=>[a(e(me),{placeholder:"Select type"})]),_:1}),a(e(pe),null,{default:s(()=>[a(e(N),{value:"organisation"},{default:s(()=>t[17]||(t[17]=[u("Organisation",-1)])),_:1,__:[17]}),a(e(N),{value:"forening/club"},{default:s(()=>t[18]||(t[18]=[u("Forening/Club",-1)])),_:1,__:[18]}),a(e(N),{value:"company"},{default:s(()=>t[19]||(t[19]=[u("Company",-1)])),_:1,__:[19]}),a(e(N),{value:"school"},{default:s(()=>t[20]||(t[20]=[u("School",-1)])),_:1,__:[20]})]),_:1})]),_:1},8,["modelValue"])])]),a(e(re),null,{default:s(()=>[a(e(P),{type:"submit",onClick:t[6]||(t[6]=l=>b()),disabled:p.value,variant:"success"},{default:s(()=>[p.value?(m(),C(e(B),{key:0,class:"h-4 w-4 animate-spin"})):I("",!0),t[21]||(t[21]=u(" Create Organisation ",-1))]),_:1,__:[21]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),Ae={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 overflow-x-auto"},Ee={class:"flex items-center justify-between"},Le={class:"flex gap-4"},tt=R({__name:"Index",props:["organisations"],setup(w){const _=[{title:"Organisations",href:"/organisations"}],o=w,p=S({searchTerm:"",danishOnly:!1,countries:[...Array.from(new Set(o.organisations.map(b=>b.country))).map(b=>({country:b,active:!0}))]}),v=S([{column:"name",header:"Name",active:!0,direction:"asc"},{column:"cvr",header:"CVR",active:!0,direction:"asc"},{column:"country",header:"Country",active:!0,direction:"asc"},{column:"address",header:"Address",active:!0,direction:"asc"},{column:"type",header:"Type",active:!0,direction:"asc"}]);return(b,c)=>(m(),x($,null,[a(e(H),{title:"Organisations"}),a(K,{breadcrumbs:_},{default:s(()=>[d("div",Ae,[d("div",Ee,[c[5]||(c[5]=d("h1",{class:"text-2xl font-bold"},"Organisations",-1)),d("div",Le,[a(De),a(e(D),null,{default:s(()=>[a(e(A),{"as-child":""},{default:s(()=>c[2]||(c[2]=[d("button",{class:"btn btn-primary"},"Actions",-1)])),_:1,__:[2]}),a(e(E),null,{default:s(()=>[a(e(T),{checked:""},{default:s(()=>c[3]||(c[3]=[u("Export CSV",-1)])),_:1,__:[3]}),a(e(T),null,{default:s(()=>c[4]||(c[4]=[u("Import CSV",-1)])),_:1,__:[4]})]),_:1})]),_:1})])]),a(e(Se),{filters:p.value,"onUpdate:filters":c[0]||(c[0]=t=>p.value=t),columns:v.value,"onUpdate:columns":c[1]||(c[1]=t=>v.value=t)},null,8,["filters","columns"]),a(e(we),{filters:p.value,columns:v.value},null,8,["filters","columns"])])]),_:1})],64))}});export{tt as default};
