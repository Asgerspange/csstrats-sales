import{h as j,a as z,b as D,c as E,_ as q}from"./AppLayout.vue_vue_type_script_setup_true_lang-DANxfHyB.js";import{d as M,u as I,c as w,r as h,i as x,e as c,F as $,f as t,h as r,g as e,w as s,j as V,b as v,m as u,y as K,t as C,G as A,p as L,z as B,M as G,s as H}from"./app-BacqOfn3.js";import{_ as J,a as X,b as Q,c as N,d as U,e as W}from"./TableHeader.vue_vue_type_script_setup_true_lang-DcFmgeeI.js";import{u as Y,a as Z,b as ee}from"./index-BvCXLVbM.js";import{_ as T}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C8n_WpZs.js";import{L as R}from"./loader-circle-BeMqdbBb.js";import{_ as P}from"./Input.vue_vue_type_script_setup_true_lang-CbEJygc0.js";import{_ as F}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-C1Ocof-Q.js";import{C as ae}from"./chevron-down-l0F7On6p.js";import{_ as te,a as se,b as le,c as oe,d as ie,e as ne,f as re}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-e-FVML7Z.js";import{_ as y}from"./Label.vue_vue_type_script_setup_true_lang-DAXH4YYk.js";import{_ as de,a as ue,b as me,c as ce,d as pe}from"./SelectValue.vue_vue_type_script_setup_true_lang-BTOZ7J60.js";import{_ as _e}from"./Textarea.vue_vue_type_script_setup_true_lang-Ckxc2sb2.js";import"./useForwardExpose-TW6ypeNl.js";import"./VisuallyHidden-5Gc-k0FP.js";import"./check-CZIyiA-v.js";import"./useFormControl-CUXCosYr.js";const fe={class:"flex items-center justify-between space-x-2 py-4"},ge={class:"flex items-center space-x-2"},ve=["value"],be={class:"flex items-center space-x-2"},ke={class:"text-sm text-gray-700"},xe={class:"flex space-x-1"},ye=["disabled"],$e=["disabled"],Ce=["disabled"],Pe=["disabled"],Ve=M({__name:"PackageTable",props:{filters:{},columns:{}},setup(S){const{toast:f}=j(),l=S,b=I(),k=w(()=>b.props.packages||[]),m=w(()=>{let _=k.value||[];if(l.filters.searchTerm){const i=l.filters.searchTerm.toLowerCase();_=_.filter(d=>d.name?.toLowerCase().includes(i)||d.organisation?.cvr?.toLowerCase().includes(i)||d.organisation?.name?.toLowerCase().includes(i))}return _}),p=w(()=>l.columns.filter(_=>_.active).map(_=>({accessorKey:_.column,header:_.header,cell:({row:i})=>i.getValue(_.column)}))),n=Y({get data(){return m.value},get columns(){return p.value},getCoreRowModel:ee(),getPaginationRowModel:Z(),initialState:{pagination:{pageSize:10}}}),a=h(null),o=_=>{B.visit(route("packages.show",_.id))},O=(_,i)=>{const d=i==="us"?`https://us.csstrats.org/custom-package/${_}`:`https://csstrats.dk/custom-package/${_}`;navigator.clipboard.writeText(d).then(()=>{f({title:"Link Copied",description:"The package link has been copied to your clipboard.",variant:"success"})}).catch(g=>{console.error("Failed to copy link:",g),f({title:"Failed to Copy Link",description:"There was an error copying the link.",variant:"destructive"})})};return(_,i)=>(c(),x($,null,[t(e(J),null,{default:s(()=>[t(e(X),null,{default:s(()=>[(c(!0),x($,null,V(e(n).getHeaderGroups(),d=>(c(),v(e(U),{key:d.id},{default:s(()=>[(c(!0),x($,null,V(d.headers,g=>(c(),v(e(W),{key:g.id},{default:s(()=>[u(C(g.isPlaceholder?"":g.column.columnDef.header),1)]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),t(e(Q),null,{default:s(()=>[e(n).getRowModel().rows.length?(c(!0),x($,{key:0},V(e(n).getRowModel().rows,d=>(c(),v(e(U),{key:d.id,onClick:g=>o(d.original),class:"cursor-pointer hover:bg-gray-100"},{default:s(()=>[(c(!0),x($,null,V(d.getVisibleCells(),g=>(c(),v(e(N),{key:g.id},{default:s(()=>[u(C(g.getValue()),1)]),_:2},1024))),128)),t(e(N),null,{default:s(()=>[t(e(T),{size:"sm",variant:"success",onClick:A(g=>O(d.original.id),["stop"]),disabled:a.value===d.original.id},{default:s(()=>[a.value===d.original.id?(c(),v(e(R),{key:0,class:"h-4 w-4 animate-spin"})):L("",!0),i[5]||(i[5]=u(" Copy Link ",-1))]),_:2,__:[5]},1032,["onClick","disabled"])]),_:2},1024),t(e(N),null,{default:s(()=>[t(e(T),{size:"sm",variant:"success",onClick:A(g=>O(d.original.id,"us"),["stop"]),disabled:a.value===d.original.id},{default:s(()=>[a.value===d.original.id?(c(),v(e(R),{key:0,class:"h-4 w-4 animate-spin"})):L("",!0),i[6]||(i[6]=u(" Copy US Link ",-1))]),_:2,__:[6]},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(c(),v(e(U),{key:1},{default:s(()=>[t(e(N),{colspan:p.value.length,class:"h-24 text-center"},{default:s(()=>i[7]||(i[7]=[u(" No packages found. ",-1)])),_:1,__:[7]},8,["colspan"])]),_:1}))]),_:1})]),_:1}),r("div",fe,[r("div",ge,[i[9]||(i[9]=r("span",{class:"text-sm text-gray-700"},"Rows per page:",-1)),r("select",{value:e(n).getState().pagination.pageSize,onChange:i[0]||(i[0]=d=>e(n).setPageSize(Number(d.target.value))),class:"border rounded px-2 py-1"},i[8]||(i[8]=[K('<option value="5">5</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option>',5)]),40,ve)]),r("div",be,[r("span",ke," Page "+C(e(n).getState().pagination.pageIndex+1)+" of "+C(e(n).getPageCount())+" ("+C(e(n).getFilteredRowModel().rows.length)+" total rows) ",1),r("div",xe,[r("button",{onClick:i[1]||(i[1]=d=>e(n).setPageIndex(0)),disabled:!e(n).getCanPreviousPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," First ",8,ye),r("button",{onClick:i[2]||(i[2]=d=>e(n).previousPage()),disabled:!e(n).getCanPreviousPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Previous ",8,$e),r("button",{onClick:i[3]||(i[3]=d=>e(n).nextPage()),disabled:!e(n).getCanNextPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Next ",8,Ce),r("button",{onClick:i[4]||(i[4]=d=>e(n).setPageIndex(e(n).getPageCount()-1)),disabled:!e(n).getCanNextPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Last ",8,Pe)])])])],64))}}),we={class:"flex items-center gap-8"},he={class:"flex items-center gap-4 w-full"},Se=M({__name:"PackageFilters",props:{filters:{},columns:{}},emits:["update:filters","update:columns"],setup(S,{emit:f}){const l=S,b=f,k=p=>{b("update:filters",{...l.filters,searchTerm:p})},m=(p,n)=>{const a=l.columns.map(o=>o.column===p?{...o,active:n}:o);b("update:columns",a)};return(p,n)=>(c(),x("div",we,[r("div",he,[t(e(P),{"model-value":p.filters.searchTerm,"onUpdate:modelValue":k,type:"text",placeholder:"Search packages (Name, Org CVR, Org Name)",class:"input input-bordered w-full max-w-xs"},null,8,["model-value"]),t(e(z),null,{default:s(()=>[t(e(D),{"as-child":""},{default:s(()=>[t(e(T),{variant:"outline"},{default:s(()=>[n[0]||(n[0]=u(" Columns ",-1)),t(e(ae),{class:"ml-2 h-4 w-4"})]),_:1,__:[0]})]),_:1}),t(e(E),{align:"end"},{default:s(()=>[(c(!0),x($,null,V(p.columns,a=>(c(),v(e(F),{key:a.column,class:"capitalize","model-value":a.active,"onUpdate:modelValue":o=>m(a.column,o)},{default:s(()=>[u(C(a.header),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})])]))}}),Te={class:"grid gap-4 py-4"},Ne={class:"grid grid-cols-4 items-center gap-4"},Me={class:"grid grid-cols-4 items-center gap-4"},Ue={class:"grid grid-cols-4 items-center gap-4"},Le={class:"grid grid-cols-4 items-center gap-4"},Re={class:"grid grid-cols-4 items-center gap-4"},Fe={class:"grid grid-cols-4 items-center gap-4"},Oe={class:"grid grid-cols-4 items-center gap-4"},Ae={class:"grid grid-cols-4 items-center gap-4"},je=M({__name:"CreatePackageDialog",setup(S){const{toast:f}=j(),l=h({name:"",price:"",monthly_price:"",description:"",max_teams:0,max_members:0,max_stratbooks:0,features:["All Tactics",w(()=>l.value.max_teams+" Team"+(l.value.max_teams>1?"s":"")),w(()=>l.value.max_members+" User"+(l.value.max_members>1?"s":"")),w(()=>l.value.max_stratbooks+" Stratbook"+(l.value.max_stratbooks>1?"s":"")),"Priority Support"],organisation_id:null}),b=I().props.organisations||[],k=h(!1),m=h(!1),p=async()=>{k.value=!0;const n={...G(l.value),features:["All Tactics",l.value.max_teams+" Team"+(l.value.max_teams>1?"s":""),l.value.max_members+" User"+(l.value.max_members>1?"s":""),l.value.max_stratbooks+" Stratbook"+(l.value.max_stratbooks>1?"s":""),"Priority Support"]},a=await fetch("/sales/packages",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(n)});try{if(a.status===201){const o=await a.json();f({title:"Package Created",description:`${o.package.name} has been created successfully.`,variant:"success"}),l.value={name:"",price:"",monthly_price:"",description:"",max_teams:0,max_members:0,max_stratbooks:0,features:[],organisation_id:null},m.value=!1,B.reload({only:["packages"]})}else if(a.status===409)f({title:"Package Already Exists",description:`${n.name} could not be created because the Package already exists.`,variant:"destructive"});else{const o=await a.json();f({title:"Package Creation Failed",description:o?.message||"Package could not be created.",variant:"destructive"})}}catch{f({title:"Error",description:"An unexpected error occurred.",variant:"destructive"})}finally{k.value=!1}};return(n,a)=>(c(),v(e(re),{open:m.value,"onUpdate:open":a[8]||(a[8]=o=>m.value=o)},{default:s(()=>[t(e(te),{"as-child":""},{default:s(()=>[t(e(T),{variant:"success"},{default:s(()=>a[9]||(a[9]=[u("New Package",-1)])),_:1,__:[9]})]),_:1}),t(e(se),{class:"sm:max-w-[425px]"},{default:s(()=>[t(e(le),null,{default:s(()=>[t(e(oe),null,{default:s(()=>a[10]||(a[10]=[u("New Package",-1)])),_:1,__:[10]}),t(e(ie),null,{default:s(()=>a[11]||(a[11]=[u(" Fill in the package details below and click save. ",-1)])),_:1,__:[11]})]),_:1}),r("div",Te,[r("div",Ne,[t(e(y),{for:"name"},{default:s(()=>a[12]||(a[12]=[u("Name",-1)])),_:1,__:[12]}),t(e(P),{id:"name",placeholder:"Package Name",class:"col-span-3",modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=o=>l.value.name=o)},null,8,["modelValue"])]),r("div",Me,[t(e(y),{for:"price"},{default:s(()=>a[13]||(a[13]=[u("Price",-1)])),_:1,__:[13]}),t(e(P),{id:"price",placeholder:"100",class:"col-span-3",modelValue:l.value.price,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value.price=o)},null,8,["modelValue"])]),r("div",Ue,[t(e(y),{for:"monthly_price"},{default:s(()=>a[14]||(a[14]=[u("Monthly Price",-1)])),_:1,__:[14]}),t(e(P),{id:"monthly_price",placeholder:"10",class:"col-span-3",modelValue:l.value.monthly_price,"onUpdate:modelValue":a[2]||(a[2]=o=>l.value.monthly_price=o)},null,8,["modelValue"])]),r("div",Le,[t(e(y),{for:"description"},{default:s(()=>a[15]||(a[15]=[u("Description",-1)])),_:1,__:[15]}),t(_e,{id:"description",placeholder:"Package Description",class:"col-span-3",modelValue:l.value.description,"onUpdate:modelValue":a[3]||(a[3]=o=>l.value.description=o)},null,8,["modelValue"])]),r("div",Re,[t(e(y),{for:"max_teams"},{default:s(()=>a[16]||(a[16]=[u("Max Teams",-1)])),_:1,__:[16]}),t(e(P),{id:"max_teams",type:"number",class:"col-span-3",modelValue:l.value.max_teams,"onUpdate:modelValue":a[4]||(a[4]=o=>l.value.max_teams=o)},null,8,["modelValue"])]),r("div",Fe,[t(e(y),{for:"max_members"},{default:s(()=>a[17]||(a[17]=[u("Max Members",-1)])),_:1,__:[17]}),t(e(P),{id:"max_members",type:"number",class:"col-span-3",modelValue:l.value.max_members,"onUpdate:modelValue":a[5]||(a[5]=o=>l.value.max_members=o)},null,8,["modelValue"])]),r("div",Oe,[t(e(y),{for:"max_stratbooks"},{default:s(()=>a[18]||(a[18]=[u("Max Stratbooks",-1)])),_:1,__:[18]}),t(e(P),{id:"max_stratbooks",type:"number",class:"col-span-3",modelValue:l.value.max_stratbooks,"onUpdate:modelValue":a[6]||(a[6]=o=>l.value.max_stratbooks=o)},null,8,["modelValue"])]),r("div",Ae,[t(e(y),{for:"organisation_id"},{default:s(()=>a[19]||(a[19]=[u("Organisation",-1)])),_:1,__:[19]}),t(e(de),{modelValue:l.value.organisation_id,"onUpdate:modelValue":a[7]||(a[7]=o=>l.value.organisation_id=o),class:"col-span-3"},{default:s(()=>[t(e(ue),{class:"w-fit"},{default:s(()=>[t(e(me),{placeholder:"Select Organisation"})]),_:1}),t(e(ce),null,{default:s(()=>[(c(!0),x($,null,V(e(b),o=>(c(),v(e(pe),{key:o.id,value:o.id},{default:s(()=>[u(C(o.name)+" ("+C(o.cvr)+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])]),t(e(ne),null,{default:s(()=>[t(e(T),{type:"submit",onClick:p,disabled:k.value,variant:"success"},{default:s(()=>[k.value?(c(),v(e(R),{key:0,class:"h-4 w-4 animate-spin"})):L("",!0),a[20]||(a[20]=u(" Create Package ",-1))]),_:1,__:[20]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),ze={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 overflow-x-auto"},De={class:"flex items-center justify-between"},Ee={class:"flex gap-4"},oa=M({__name:"Index",props:["packages"],setup(S){const f=[{title:"Packages",href:"/packages"}],l=h({searchTerm:""}),b=h([{column:"name",header:"Name",active:!0,direction:"asc"},{column:"organisation.name",header:"Organisation",active:!0,direction:"asc"},{column:"price",header:"Price",active:!0,direction:"asc"},{column:"monthly_price",header:"Monthly Price",active:!0,direction:"asc"},{column:"max_teams",header:"Max Teams",active:!0,direction:"asc"},{column:"max_members",header:"Max Users",active:!0,direction:"asc"},{column:"max_stratbooks",header:"Max Stratbooks",active:!0,direction:"asc"},{column:"created_at",header:"Created At",active:!0,direction:"asc"}]);return(k,m)=>(c(),x($,null,[t(e(H),{title:"Packages"}),t(q,{breadcrumbs:f},{default:s(()=>[r("div",ze,[r("div",De,[m[5]||(m[5]=r("h1",{class:"text-2xl font-bold"},"Packages",-1)),r("div",Ee,[t(e(je)),t(e(z),null,{default:s(()=>[t(e(D),{"as-child":""},{default:s(()=>m[2]||(m[2]=[r("button",{class:"btn btn-primary"},"Actions",-1)])),_:1,__:[2]}),t(e(E),null,{default:s(()=>[t(e(F),{checked:""},{default:s(()=>m[3]||(m[3]=[u("Export CSV",-1)])),_:1,__:[3]}),t(e(F),null,{default:s(()=>m[4]||(m[4]=[u("Import CSV",-1)])),_:1,__:[4]})]),_:1})]),_:1})])]),t(e(Se),{filters:l.value,"onUpdate:filters":m[0]||(m[0]=p=>l.value=p),columns:b.value,"onUpdate:columns":m[1]||(m[1]=p=>b.value=p)},null,8,["filters","columns"]),t(e(Ve),{filters:l.value,columns:b.value},null,8,["filters","columns"])])]),_:1})],64))}});export{oa as default};
