import{_ as R,a as M,b as T,c as F}from"./AppLayout.vue_vue_type_script_setup_true_lang-FaTjhN2J.js";import{_ as U}from"./Input.vue_vue_type_script_setup_true_lang-DlYTGMU1.js";import{_ as k}from"./Checkbox.vue_vue_type_script_setup_true_lang-pKluhMtB.js";import{d as S,a as m,o as d,e as n,b as o,f as t,u as O,r as P,c as D,v as C,F as b,w as i,g as y,h as g,i as N,t as $,l as A,n as I}from"./app-CwCiw8VX.js";import{_ as B,a as j,b as E,c as V,d as h,e as K}from"./TableHeader.vue_vue_type_script_setup_true_lang-BYjWWSmy.js";import{_ as z,v as H}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DzuNUHST.js";import{u as q,F as L,b as G,g as J,a as Q}from"./index-c3Ux_E0P.js";import{A as W}from"./arrow-up-down-CIdDJE7y.js";import{_ as X}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-bPCQmygW.js";import"./useForwardExpose-HAH8QY-T.js";import"./VisuallyHidden-CHTwFaiP.js";import"./useFormControl-DeZL60T6.js";import"./VisuallyHiddenInput-BRYIfQUi.js";import"./check-BdT8GyEB.js";const Y={class:"flex items-center gap-8"},Z={class:"flex items-center gap-4 w-full"},ee={class:"flex items-center gap-2"},te={class:"flex items-center gap-2"},se=S({__name:"SubscriptionFilters",props:{filters:{},columns:{}},emits:["update:filters","update:columns"],setup(v,{emit:f}){const c=v,u=f,_=e=>{u("update:filters",{...c.filters,searchTerm:e})},p=e=>{u("update:filters",{...c.filters,activeOnly:e})},a=e=>{u("update:filters",{...c.filters,pastDueOnly:e})};return(e,s)=>(d(),m("div",Y,[n("div",Z,[o(t(U),{"model-value":e.filters.searchTerm,"onUpdate:modelValue":_,type:"text",placeholder:"Search subscriptions (Customer [Email, Id, Name], Package)",class:"input input-bordered w-full max-w-lg"},null,8,["model-value"]),n("div",ee,[o(t(k),{"model-value":e.filters.activeOnly,"onUpdate:modelValue":p,class:"ml-4"},null,8,["model-value"]),s[0]||(s[0]=n("label",null,"Active only",-1))]),n("div",te,[o(t(k),{"model-value":e.filters.pastDueOnly,"onUpdate:modelValue":a,class:"ml-4"},null,8,["model-value"]),s[1]||(s[1]=n("label",null,"Past due only",-1))])])]))}}),re={class:"flex items-center justify-between space-x-2 py-4"},ae={class:"flex items-center space-x-2"},ne={class:"text-sm text-gray-700"},le={class:"flex space-x-1"},oe=["disabled"],ie=["disabled"],ue=["disabled"],de=["disabled"],ce=S({__name:"SubscriptionTable",props:{columns:{},filters:{}},setup(v){const{subscriptions:f}=O().props,c=P([]),u=v,_=D(()=>u.columns.filter(e=>!["customer_relation"].includes(e.column)).map(e=>{const s=["id","created","status","product_id"].includes(e.column);return{accessorKey:e.column,header:({column:r})=>(e.header==="Current_period_start"&&(e.header="Current Period"),s?(e.header==="Product_id"&&(e.header="Product"),C(z,{variant:"ghost",onClick:()=>r.toggleSorting(r.getIsSorted()==="asc")},()=>[e.header,C(W,{class:"ml-2 h-4 w-4"})])):C("span",e.header)),accessorFn:r=>{if(e.column==="created")return r.created*1e3;if(e.column==="customer")return r.customer_relation?.name||"N/A";if(e.column==="product_id"){const l=r.package?.name,x=r.package?.price,w=r.currency;return!l||!x||!w?r.plan.product:`${l} ${x} ${w}`}return e.column==="current_period_start"?r.current_period_start*1e3:r[e.column]},cell:({getValue:r,row:l})=>{const x=r();return e.column==="created"?new Date(l.original.created*1e3).toLocaleDateString():e.column==="current_period_start"?new Date(l.original.current_period_start*1e3).toLocaleDateString()+" - "+new Date(l.original.current_period_end*1e3).toLocaleDateString():x},enableSorting:s}})),p=D(()=>{let e=f||[];if(u.filters.searchTerm){const s=u.filters.searchTerm.toLowerCase();e=e.filter(r=>r.sub_id?.toLowerCase().includes(s)||r.customer_relation?.email?.toLowerCase().includes(s)||r.customer_relation?.name?.toLowerCase().includes(s)||r.customer_relation?.cus_id?.toLowerCase().includes(s)||r.package?.name?.toLowerCase().includes(s))}return u.filters.activeOnly&&(e=e.filter(s=>s.status==="active")),u.filters.pastDueOnly&&(e=e.filter(s=>s.status==="past_due")),e||[]}),a=q({get data(){return p.value},get columns(){return _.value},getCoreRowModel:Q(),getPaginationRowModel:J(),getSortedRowModel:G(),onSortingChange:e=>H(e,c),state:{get sorting(){return c.value}},initialState:{pagination:{pageSize:10},sorting:[]}});return(e,s)=>(d(),m(b,null,[o(t(B),null,{default:i(()=>[o(t(j),null,{default:i(()=>[(d(!0),m(b,null,y(t(a).getHeaderGroups(),r=>(d(),g(t(h),{key:r.id},{default:i(()=>[(d(!0),m(b,null,y(r.headers,l=>(d(),g(t(K),{key:l.id},{default:i(()=>[l.isPlaceholder?A("",!0):(d(),g(t(L),{key:0,render:l.column.columnDef.header,props:{column:l.column}},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),o(t(E),null,{default:i(()=>[t(a).getRowModel().rows.length?(d(!0),m(b,{key:0},y(t(a).getRowModel().rows,r=>(d(),g(t(h),{key:r.id,class:"cursor-pointer hover:bg-gray-100"},{default:i(()=>[(d(!0),m(b,null,y(r.getVisibleCells(),l=>(d(),g(t(V),{key:l.id},{default:i(()=>[o(t(L),{render:l.column.columnDef.cell||(()=>l.getValue()),props:{getValue:()=>l.getValue(),row:r}},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(d(),g(t(h),{key:1},{default:i(()=>[o(t(V),{colspan:_.value.length,class:"h-24 text-center"},{default:i(()=>s[4]||(s[4]=[N(" No subscriptions found. ",-1)])),_:1,__:[4]},8,["colspan"])]),_:1}))]),_:1})]),_:1}),n("div",re,[n("div",ae,[n("span",ne," Page "+$(t(a).getState().pagination.pageIndex+1)+" of "+$(t(a).getPageCount())+" ("+$(t(a).getFilteredRowModel().rows.length)+" total rows) ",1),n("div",le,[n("button",{onClick:s[0]||(s[0]=r=>t(a).setPageIndex(0)),disabled:!t(a).getCanPreviousPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," First ",8,oe),n("button",{onClick:s[1]||(s[1]=r=>t(a).previousPage()),disabled:!t(a).getCanPreviousPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Previous ",8,ie),n("button",{onClick:s[2]||(s[2]=r=>t(a).nextPage()),disabled:!t(a).getCanNextPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Next ",8,ue),n("button",{onClick:s[3]||(s[3]=r=>t(a).setPageIndex(t(a).getPageCount()-1)),disabled:!t(a).getCanNextPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Last ",8,de)])])])],64))}}),pe={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 overflow-x-auto"},me={class:"flex items-center justify-between"},De=S({__name:"Index",setup(v){const{props:f}=O();console.log(f.subscriptions[0]);const c=[{title:"Billing",href:"/sales/billing"},{title:"Subscriptions",href:"/sales/billing/subscriptions"}],u=P({searchTerm:"",activeOnly:!1,pastDueOnly:!1}),_=["object","package","customer_relation","plan","items","currency","coupon","current_period_end"],p=P(Object.keys(f.subscriptions[0]||{}).filter(a=>!_.includes(a)).map(a=>({column:a,header:a.charAt(0).toUpperCase()+a.slice(1),active:!0,direction:"asc"})));return(a,e)=>(d(),m(b,null,[o(t(I),{title:"Subscriptions"}),o(F,{breadcrumbs:c},{default:i(()=>[n("div",pe,[n("div",me,[e[4]||(e[4]=n("h1",{class:"text-2xl font-bold"},"Subscriptions",-1)),o(t(R),null,{default:i(()=>[o(t(M),{"as-child":""},{default:i(()=>e[2]||(e[2]=[n("button",{class:"btn btn-primary"},"Actions",-1)])),_:1,__:[2]}),o(t(T),null,{default:i(()=>[o(t(X),{checked:""},{default:i(()=>e[3]||(e[3]=[N("Export CSV",-1)])),_:1,__:[3]})]),_:1})]),_:1})]),o(t(se),{filters:u.value,"onUpdate:filters":e[0]||(e[0]=s=>u.value=s),columns:p.value,"onUpdate:columns":e[1]||(e[1]=s=>p.value=s)},null,8,["filters","columns"]),o(t(ce),{filters:u.value,columns:p.value},null,8,["filters","columns"])])]),_:1})],64))}});export{De as default};
