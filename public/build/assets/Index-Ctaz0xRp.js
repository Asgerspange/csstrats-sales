import{u as A,_ as D,a as j,b as E,c as q}from"./AppLayout.vue_vue_type_script_setup_true_lang-D9M3x5ue.js";import{d as M,u as I,c as h,r as S,a as k,o as c,F as $,b as t,e as r,f as e,w as l,g as w,h as b,i as u,j as K,t as C,k as z,l as L,m as B,O as H,P as J,x as Q,Q as X,D as G,n as W}from"./app-D_3ES-MA.js";import{u as Y,_ as Z,a as ee,b as ae,c as N,d as U,e as te,g as se,f as le}from"./index-BBYeWMhU.js";import{_ as T,a as oe}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DRehq9_I.js";import{L as R}from"./loader-circle-BtasXw6i.js";import{_ as V}from"./Input.vue_vue_type_script_setup_true_lang-CnHYR_KV.js";import{_ as F}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-Ckl1VtZG.js";import{C as ie}from"./chevron-down-Btkkdgsb.js";import{_ as ne,a as re,b as de,c as ue,d as me,e as ce,f as pe}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-BbLZj7f_.js";import{_ as y}from"./Label.vue_vue_type_script_setup_true_lang-DN94hrUr.js";import{_ as _e,a as fe,b as ge,c as ve,d as xe}from"./SelectValue.vue_vue_type_script_setup_true_lang-DCIDyPaO.js";import{u as be}from"./useForwardExpose-DKOBYQgN.js";import"./VisuallyHidden-CBaPXAve.js";import"./check-Bp38obHO.js";import"./useFormControl-CT9Zey5N.js";const ke={class:"flex items-center justify-between space-x-2 py-4"},ye={class:"flex items-center space-x-2"},$e=["value"],Ce={class:"flex items-center space-x-2"},Pe={class:"text-sm text-gray-700"},Ve={class:"flex space-x-1"},we=["disabled"],he=["disabled"],Se=["disabled"],Te=["disabled"],Me=M({__name:"PackageTable",props:{filters:{},columns:{}},setup(P){const{toast:f}=A(),s=P,v=I(),g=h(()=>v.props.packages||[]),m=h(()=>{let _=g.value||[];if(s.filters.searchTerm){const n=s.filters.searchTerm.toLowerCase();_=_.filter(d=>d.name?.toLowerCase().includes(n)||d.organisation?.cvr?.toLowerCase().includes(n)||d.organisation?.name?.toLowerCase().includes(n))}return _}),p=h(()=>s.columns.filter(_=>_.active).map(_=>({accessorKey:_.column,header:_.header,cell:({row:n})=>n.getValue(_.column)}))),i=Y({get data(){return m.value},get columns(){return p.value},getCoreRowModel:le(),getPaginationRowModel:se(),initialState:{pagination:{pageSize:10}}}),a=S(null),o=_=>{B.visit(route("packages.show",_.id))},O=(_,n)=>{const d=n==="us"?`https://us.csstrats.org/custom-package/${_}`:`https://csstrats.dk/custom-package/${_}`;navigator.clipboard.writeText(d).then(()=>{f({title:"Link Copied",description:"The package link has been copied to your clipboard.",variant:"success"})}).catch(x=>{console.error("Failed to copy link:",x),f({title:"Failed to Copy Link",description:"There was an error copying the link.",variant:"destructive"})})};return(_,n)=>(c(),k($,null,[t(e(Z),null,{default:l(()=>[t(e(ee),null,{default:l(()=>[(c(!0),k($,null,w(e(i).getHeaderGroups(),d=>(c(),b(e(U),{key:d.id},{default:l(()=>[(c(!0),k($,null,w(d.headers,x=>(c(),b(e(te),{key:x.id},{default:l(()=>[u(C(x.isPlaceholder?"":x.column.columnDef.header),1)]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),t(e(ae),null,{default:l(()=>[e(i).getRowModel().rows.length?(c(!0),k($,{key:0},w(e(i).getRowModel().rows,d=>(c(),b(e(U),{key:d.id,onClick:x=>o(d.original),class:"cursor-pointer hover:bg-gray-100"},{default:l(()=>[(c(!0),k($,null,w(d.getVisibleCells(),x=>(c(),b(e(N),{key:x.id},{default:l(()=>[u(C(x.getValue()),1)]),_:2},1024))),128)),t(e(N),null,{default:l(()=>[t(e(T),{size:"sm",variant:"success",onClick:z(x=>O(d.original.id),["stop"]),disabled:a.value===d.original.id},{default:l(()=>[a.value===d.original.id?(c(),b(e(R),{key:0,class:"h-4 w-4 animate-spin"})):L("",!0),n[5]||(n[5]=u(" Copy Link ",-1))]),_:2,__:[5]},1032,["onClick","disabled"])]),_:2},1024),t(e(N),null,{default:l(()=>[t(e(T),{size:"sm",variant:"success",onClick:z(x=>O(d.original.id,"us"),["stop"]),disabled:a.value===d.original.id},{default:l(()=>[a.value===d.original.id?(c(),b(e(R),{key:0,class:"h-4 w-4 animate-spin"})):L("",!0),n[6]||(n[6]=u(" Copy US Link ",-1))]),_:2,__:[6]},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(c(),b(e(U),{key:1},{default:l(()=>[t(e(N),{colspan:p.value.length,class:"h-24 text-center"},{default:l(()=>n[7]||(n[7]=[u(" No packages found. ",-1)])),_:1,__:[7]},8,["colspan"])]),_:1}))]),_:1})]),_:1}),r("div",ke,[r("div",ye,[n[9]||(n[9]=r("span",{class:"text-sm text-gray-700"},"Rows per page:",-1)),r("select",{value:e(i).getState().pagination.pageSize,onChange:n[0]||(n[0]=d=>e(i).setPageSize(Number(d.target.value))),class:"border rounded px-2 py-1"},n[8]||(n[8]=[K('<option value="5">5</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option>',5)]),40,$e)]),r("div",Ce,[r("span",Pe," Page "+C(e(i).getState().pagination.pageIndex+1)+" of "+C(e(i).getPageCount())+" ("+C(e(i).getFilteredRowModel().rows.length)+" total rows) ",1),r("div",Ve,[r("button",{onClick:n[1]||(n[1]=d=>e(i).setPageIndex(0)),disabled:!e(i).getCanPreviousPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," First ",8,we),r("button",{onClick:n[2]||(n[2]=d=>e(i).previousPage()),disabled:!e(i).getCanPreviousPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Previous ",8,he),r("button",{onClick:n[3]||(n[3]=d=>e(i).nextPage()),disabled:!e(i).getCanNextPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Next ",8,Se),r("button",{onClick:n[4]||(n[4]=d=>e(i).setPageIndex(e(i).getPageCount()-1)),disabled:!e(i).getCanNextPage(),class:"px-2 py-1 border rounded disabled:opacity-50"}," Last ",8,Te)])])])],64))}}),Ne={class:"flex items-center gap-8"},Ue={class:"flex items-center gap-4 w-full"},Le=M({__name:"PackageFilters",props:{filters:{},columns:{}},emits:["update:filters","update:columns"],setup(P,{emit:f}){const s=P,v=f,g=p=>{v("update:filters",{...s.filters,searchTerm:p})},m=(p,i)=>{const a=s.columns.map(o=>o.column===p?{...o,active:i}:o);v("update:columns",a)};return(p,i)=>(c(),k("div",Ne,[r("div",Ue,[t(e(V),{"model-value":p.filters.searchTerm,"onUpdate:modelValue":g,type:"text",placeholder:"Search packages (Name, Org CVR, Org Name)",class:"input input-bordered w-full max-w-xs"},null,8,["model-value"]),t(e(D),null,{default:l(()=>[t(e(j),{"as-child":""},{default:l(()=>[t(e(T),{variant:"outline"},{default:l(()=>[i[0]||(i[0]=u(" Columns ",-1)),t(e(ie),{class:"ml-2 h-4 w-4"})]),_:1,__:[0]})]),_:1}),t(e(E),{align:"end"},{default:l(()=>[(c(!0),k($,null,w(p.columns,a=>(c(),b(e(F),{key:a.column,class:"capitalize","model-value":a.active,"onUpdate:modelValue":o=>m(a.column,o)},{default:l(()=>[u(C(a.header),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})])]))}}),Re=M({__name:"Textarea",props:{class:{},defaultValue:{},modelValue:{}},emits:["update:modelValue"],setup(P,{emit:f}){const s=P,g=be(s,"modelValue",f,{passive:!0,defaultValue:s.defaultValue});return(m,p)=>H((c(),k("textarea",{"onUpdate:modelValue":p[0]||(p[0]=i=>X(g)?g.value=i:null),"data-slot":"textarea",class:Q(e(oe)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s.class))},null,2)),[[J,e(g)]])}}),Fe={class:"grid gap-4 py-4"},Oe={class:"grid grid-cols-4 items-center gap-4"},ze={class:"grid grid-cols-4 items-center gap-4"},Ae={class:"grid grid-cols-4 items-center gap-4"},De={class:"grid grid-cols-4 items-center gap-4"},je={class:"grid grid-cols-4 items-center gap-4"},Ee={class:"grid grid-cols-4 items-center gap-4"},Ie={class:"grid grid-cols-4 items-center gap-4"},Be={class:"grid grid-cols-4 items-center gap-4"},qe=M({__name:"CreatePackageDialog",setup(P){const{toast:f}=A(),s=S({name:"",price:"",monthly_price:"",description:"",max_teams:0,max_members:0,max_stratbooks:0,features:["All Tactics",h(()=>s.value.max_teams+" Team"+(s.value.max_teams>1?"s":"")),h(()=>s.value.max_members+" User"+(s.value.max_members>1?"s":"")),h(()=>s.value.max_stratbooks+" Stratbook"+(s.value.max_stratbooks>1?"s":"")),"Priority Support"],organisation_id:null}),v=I().props.organisations||[],g=S(!1),m=S(!1),p=async()=>{g.value=!0;const i={...G(s.value),features:["All Tactics",s.value.max_teams+" Team"+(s.value.max_teams>1?"s":""),s.value.max_members+" User"+(s.value.max_members>1?"s":""),s.value.max_stratbooks+" Stratbook"+(s.value.max_stratbooks>1?"s":""),"Priority Support"]},a=await fetch("/packages",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(i)});try{if(a.status===201){const o=await a.json();f({title:"Package Created",description:`${o.package.name} has been created successfully.`,variant:"success"}),s.value={name:"",price:"",monthly_price:"",description:"",max_teams:0,max_members:0,max_stratbooks:0,features:[],organisation_id:null},m.value=!1,B.reload({only:["packages"]})}else if(a.status===409)f({title:"Package Already Exists",description:`${i.name} could not be created because the Package already exists.`,variant:"destructive"});else{const o=await a.json();f({title:"Package Creation Failed",description:o?.message||"Package could not be created.",variant:"destructive"})}}catch{f({title:"Error",description:"An unexpected error occurred.",variant:"destructive"})}finally{g.value=!1}};return(i,a)=>(c(),b(e(pe),{open:m.value,"onUpdate:open":a[8]||(a[8]=o=>m.value=o)},{default:l(()=>[t(e(ne),{"as-child":""},{default:l(()=>[t(e(T),{variant:"success"},{default:l(()=>a[9]||(a[9]=[u("New Package",-1)])),_:1,__:[9]})]),_:1}),t(e(re),{class:"sm:max-w-[425px]"},{default:l(()=>[t(e(de),null,{default:l(()=>[t(e(ue),null,{default:l(()=>a[10]||(a[10]=[u("New Package",-1)])),_:1,__:[10]}),t(e(me),null,{default:l(()=>a[11]||(a[11]=[u(" Fill in the package details below and click save. ",-1)])),_:1,__:[11]})]),_:1}),r("div",Fe,[r("div",Oe,[t(e(y),{for:"name"},{default:l(()=>a[12]||(a[12]=[u("Name",-1)])),_:1,__:[12]}),t(e(V),{id:"name",placeholder:"Package Name",class:"col-span-3",modelValue:s.value.name,"onUpdate:modelValue":a[0]||(a[0]=o=>s.value.name=o)},null,8,["modelValue"])]),r("div",ze,[t(e(y),{for:"price"},{default:l(()=>a[13]||(a[13]=[u("Price",-1)])),_:1,__:[13]}),t(e(V),{id:"price",placeholder:"100",class:"col-span-3",modelValue:s.value.price,"onUpdate:modelValue":a[1]||(a[1]=o=>s.value.price=o)},null,8,["modelValue"])]),r("div",Ae,[t(e(y),{for:"monthly_price"},{default:l(()=>a[14]||(a[14]=[u("Monthly Price",-1)])),_:1,__:[14]}),t(e(V),{id:"monthly_price",placeholder:"10",class:"col-span-3",modelValue:s.value.monthly_price,"onUpdate:modelValue":a[2]||(a[2]=o=>s.value.monthly_price=o)},null,8,["modelValue"])]),r("div",De,[t(e(y),{for:"description"},{default:l(()=>a[15]||(a[15]=[u("Description",-1)])),_:1,__:[15]}),t(Re,{id:"description",placeholder:"Package Description",class:"col-span-3",modelValue:s.value.description,"onUpdate:modelValue":a[3]||(a[3]=o=>s.value.description=o)},null,8,["modelValue"])]),r("div",je,[t(e(y),{for:"max_teams"},{default:l(()=>a[16]||(a[16]=[u("Max Teams",-1)])),_:1,__:[16]}),t(e(V),{id:"max_teams",type:"number",class:"col-span-3",modelValue:s.value.max_teams,"onUpdate:modelValue":a[4]||(a[4]=o=>s.value.max_teams=o)},null,8,["modelValue"])]),r("div",Ee,[t(e(y),{for:"max_members"},{default:l(()=>a[17]||(a[17]=[u("Max Members",-1)])),_:1,__:[17]}),t(e(V),{id:"max_members",type:"number",class:"col-span-3",modelValue:s.value.max_members,"onUpdate:modelValue":a[5]||(a[5]=o=>s.value.max_members=o)},null,8,["modelValue"])]),r("div",Ie,[t(e(y),{for:"max_stratbooks"},{default:l(()=>a[18]||(a[18]=[u("Max Stratbooks",-1)])),_:1,__:[18]}),t(e(V),{id:"max_stratbooks",type:"number",class:"col-span-3",modelValue:s.value.max_stratbooks,"onUpdate:modelValue":a[6]||(a[6]=o=>s.value.max_stratbooks=o)},null,8,["modelValue"])]),r("div",Be,[t(e(y),{for:"organisation_id"},{default:l(()=>a[19]||(a[19]=[u("Organisation",-1)])),_:1,__:[19]}),t(e(_e),{modelValue:s.value.organisation_id,"onUpdate:modelValue":a[7]||(a[7]=o=>s.value.organisation_id=o),class:"col-span-3"},{default:l(()=>[t(e(fe),{class:"w-fit"},{default:l(()=>[t(e(ge),{placeholder:"Select Organisation"})]),_:1}),t(e(ve),null,{default:l(()=>[(c(!0),k($,null,w(e(v),o=>(c(),b(e(xe),{key:o.id,value:o.id},{default:l(()=>[u(C(o.name)+" ("+C(o.cvr)+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])]),t(e(ce),null,{default:l(()=>[t(e(T),{type:"submit",onClick:p,disabled:g.value,variant:"success"},{default:l(()=>[g.value?(c(),b(e(R),{key:0,class:"h-4 w-4 animate-spin"})):L("",!0),a[20]||(a[20]=u(" Create Package ",-1))]),_:1,__:[20]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),Ke={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 overflow-x-auto"},He={class:"flex items-center justify-between"},Je={class:"flex gap-4"},da=M({__name:"Index",props:["packages"],setup(P){const f=[{title:"Packages",href:"/packages"}],s=S({searchTerm:""}),v=S([{column:"name",header:"Name",active:!0,direction:"asc"},{column:"organisation.name",header:"Organisation",active:!0,direction:"asc"},{column:"price",header:"Price",active:!0,direction:"asc"},{column:"monthly_price",header:"Monthly Price",active:!0,direction:"asc"},{column:"max_teams",header:"Max Teams",active:!0,direction:"asc"},{column:"max_members",header:"Max Users",active:!0,direction:"asc"},{column:"max_stratbooks",header:"Max Stratbooks",active:!0,direction:"asc"},{column:"created_at",header:"Created At",active:!0,direction:"asc"}]);return(g,m)=>(c(),k($,null,[t(e(W),{title:"Packages"}),t(q,{breadcrumbs:f},{default:l(()=>[r("div",Ke,[r("div",He,[m[5]||(m[5]=r("h1",{class:"text-2xl font-bold"},"Packages",-1)),r("div",Je,[t(e(qe)),t(e(D),null,{default:l(()=>[t(e(j),{"as-child":""},{default:l(()=>m[2]||(m[2]=[r("button",{class:"btn btn-primary"},"Actions",-1)])),_:1,__:[2]}),t(e(E),null,{default:l(()=>[t(e(F),{checked:""},{default:l(()=>m[3]||(m[3]=[u("Export CSV",-1)])),_:1,__:[3]}),t(e(F),null,{default:l(()=>m[4]||(m[4]=[u("Import CSV",-1)])),_:1,__:[4]})]),_:1})]),_:1})])]),t(e(Le),{filters:s.value,"onUpdate:filters":m[0]||(m[0]=p=>s.value=p),columns:v.value,"onUpdate:columns":m[1]||(m[1]=p=>v.value=p)},null,8,["filters","columns"]),t(e(Me),{filters:s.value,columns:v.value},null,8,["filters","columns"])])]),_:1})],64))}});export{da as default};
